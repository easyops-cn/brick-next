"use strict";(self.webpackChunk_next_bricks_form=self.webpackChunk_next_bricks_form||[]).push([[2683,5628],{88:(e,t,r)=>{r.d(t,{K:()=>n,NS:()=>a,k:()=>i});var n=function(e){return e.UNIQUE="UNIQUE",e}({}),a="bricks/form/dynamic-form-item",i={en:{UNIQUE:"{{ name }} can not repeat!"},zh:{UNIQUE:"{{ name }} 不能重复！"}}},3319:(e,t,r)=>{r.r(t),r.d(t,{DynamicFormItem:()=>U,DynamicFormItemComponent:()=>ae,uniqueValidatorFN:()=>K});var n,a,i,o,s,l,c,u,h,f,d,p,v,m,g,b,y,w,Z=r(7896),k=r(3028),E=r(6666),S=r(3395),j=r(1815),O=r(381),x=r(687),B=r(2604),C=r(8657),M=r.n(C),N=r(1218),F=r(3105),I=r(2504),P=r(5724),W=(r(5254),r(5178)),D=r(1391),T=r(88),R=r(7088);(0,R.initializeReactI18n)(T.NS,T.k);var U,{defineElement:q,property:A,event:V}=(0,N.createDecorators)(),_=(0,F.wrapBrick)("eo-icon"),z=(0,F.wrapBrick)("eo-button"),Q=(0,F.wrapBrick)("eo-form",{onValuesChange:"values.change",onValidateSuccess:"validate.success",onValidateError:"validate.error"}),G=(0,F.wrapBrick)("eo-form-item");function K(e,t,r){return()=>{var n,a,i,o,s=null==e||null===(n=e.curElement)||void 0===n||null===(n=n.value)||void 0===n?void 0:n.map((e=>e[t.name]));return new Set(s).size!==s.length?null!==(a=null===(i=t.message)||void 0===i?void 0:i.unique)&&void 0!==a?a:r(T.K.UNIQUE,{name:null!==(o=t.label)&&void 0!==o?o:t.name}):""}}a=q("eo-dynamic-form-item",{styleTexts:[P.Z],alias:["form.dynamic-form-item"]}),i=A(),s=A(),c=A({type:Boolean}),h=A({attribute:!1}),d=A({attribute:!1}),v=V({type:"change"});var $=new WeakMap,H=new WeakMap,J=new WeakMap,L=new WeakMap,X=new WeakMap,Y=new WeakMap,ee=new WeakMap;class te extends D.G{constructor(){super(...arguments),(0,S.Z)(this,ee,{get:ne,set:re}),(0,S.Z)(this,$,{writable:!0,value:(y(this),o(this))}),(0,S.Z)(this,H,{writable:!0,value:l(this)}),(0,S.Z)(this,J,{writable:!0,value:u(this)}),(0,S.Z)(this,L,{writable:!0,value:f(this)}),(0,S.Z)(this,X,{writable:!0,value:p(this)}),(0,S.Z)(this,Y,{writable:!0,value:m(this)}),(0,E.Z)(this,"handleDynamicFormChange",(e=>{var t;this.value=e,(0,x.Z)(this,ee).emit(e),null===(t=this.getFormElement())||void 0===t||t.resetValidateState()}))}get name(){return(0,x.Z)(this,$)}set name(e){(0,O.Z)(this,$,e)}get label(){return(0,x.Z)(this,H)}set label(e){(0,O.Z)(this,H,e)}get required(){return(0,x.Z)(this,J)}set required(e){(0,O.Z)(this,J,e)}get value(){return(0,x.Z)(this,L)}set value(e){(0,O.Z)(this,L,e)}get useBrick(){return(0,x.Z)(this,X)}set useBrick(e){(0,O.Z)(this,X,e)}render(){return M().createElement(ae,{formElement:this.getFormElement(),curElement:this,name:this.name,label:this.label,required:this.required,useBrick:this.useBrick,value:this.value,validateState:this.validateState,needValidate:!1,notRender:this.notRender,helpBrick:this.helpBrick,trigger:"handleDynamicFormChange",onChange:this.handleDynamicFormChange,onValuesChange:this.handleDynamicFormChange})}}function re(e){b(this,e)}function ne(){return g(this)}function ae(e){var t,{t:r}=(0,R.useTranslation)(T.NS),n=(0,C.useRef)(null),[a,i]=(0,C.useState)(null!==(t=e.value)&&void 0!==t?t:[]),[o,s]=(0,C.useState)([]),l=(0,C.useMemo)((()=>o.map((e=>(0,W.omit)(e,"properties.label")))),[o]);(0,C.useEffect)((()=>{var t;(0,W.isEqual)(e.value,a)||i(null!==(t=e.value)&&void 0!==t?t:[])}),[e.value]),(0,C.useEffect)((()=>{if(e.useBrick){var t=(0,W.flatten)(new Array(e.useBrick));s(t.map((t=>{var{properties:n={}}=t;if(n.unique){var a=[K(e,n,r)];return n.validator&&(a=[...(0,W.flatten)(new Array(n.validator)),...a]),(0,k.Z)((0,k.Z)({},t),{},{properties:(0,k.Z)((0,k.Z)({},t.properties),{},{validator:a})})}return t})))}}),[e.useBrick,e.curElement]);var c=(0,C.useCallback)(((t,r)=>{var n;null===(n=e.onChange)||void 0===n||n.call(e,a.map(((e,n)=>n===r?t.detail.allValues:e)))}),[e,a]),u=(0,C.useCallback)((t=>{var r,n=a.filter(((e,r)=>r!==t));i(n),null===(r=e.onChange)||void 0===r||r.call(e,n)}),[e,a]);return M().createElement(G,(0,Z.Z)({},e,{validator:()=>{var e=n.current,t=null==e?void 0:e.querySelectorAll(".dynamic-form"),r=[];return t.length&&t.forEach((e=>{r.push(e.validate())})),r.every(Boolean)?"":"动态表单校验失败"}}),M().createElement("div",{className:"dynamic-form-wrapper",ref:n},a.map(((e,t)=>M().createElement("div",{className:"dynamic-form-item",key:t},!(0,W.isEmpty)(o)&&M().createElement(Q,{layout:"vertical",formStyle:{flexDirection:"row",alignItems:"flex-start"},className:"dynamic-form",values:e,defaultEmitValuesChange:!1,onValuesChange:e=>c(e,t)},M().createElement(I.ReactUseMultipleBricks,{useBrick:0===t?o:l,data:e}),M().createElement("div",{className:"remove-btn-wrapper"},M().createElement(_,{lib:"easyops",category:"assets-inventory",icon:"out",className:"remove-btn",onClick:()=>u(t)})))))),M().createElement(z,{className:"add-btn",icon:{category:"assets-inventory",icon:"xin",lib:"easyops"},type:"dashed",buttonStyle:{width:"100%"},onClick:()=>{i(a.concat({}))}},"添加")),M().createElement("slot",{name:"helpSlot"}))}w=te,({e:[o,l,u,f,p,m,g,b,y],c:[U,n]}=(0,B.Z)(w,[[i,1,"name"],[s,1,"label"],[c,1,"required"],[h,1,"value"],[d,1,"useBrick"],[v,1,"changeEvent",e=>(0,x.Z)(e,Y),(e,t)=>(0,O.Z)(e,Y,t)]],[a],0,(e=>ee.has((0,j.Z)(e))))),n()},5724:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(9601),a=r.n(n),i=r(2609),o=r.n(i)()(a());o.push([e.id,".dynamic-form-wrapper{border-radius:6px;padding:16px;background:var(--color-fill-bg-base-1)}.remove-btn{cursor:pointer;justify-content:center;display:flex;align-items:center;width:16px;height:16px;border:1px solid;border-radius:50%;line-height:12px;padding:2px;margin-left:8px}.remove-btn-wrapper{padding-top:4px}.dynamic-form > *:not(.remove-btn-wrapper){flex:1;margin-right:4px}.add-btn{width:calc(100% - 34px)}.dynamic-form-item:first-child .dynamic-form:has(*[label]) .remove-btn-wrapper{margin-top:22px}",""]);const s=o.toString()},2609:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);n&&o[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),t.push(u))}},t}},9601:e=>{e.exports=function(e){return e[1]}},2604:(e,t,r)=>{r.d(t,{Z:()=>v});var n=r(6522),a=r(1815);function i(e,t){return function(r){(function(e,t){if(e.v)throw new Error("attempted to call addInitializer after decoration was finished")})(t),l(r,"An initializer"),e.push(r)}}function o(e,t){if(!e(t))throw new TypeError("Attempted to access private element on non-instance")}function s(e,t,r,n,a,s,l,c,u,h){var f;switch(s){case 1:f="accessor";break;case 2:f="method";break;case 3:f="getter";break;case 4:f="setter";break;default:f="field"}var d,p,v={kind:f,name:c?"#"+r:r,static:l,private:c},m={v:!1};if(0!==s&&(v.addInitializer=i(a,m)),c||0!==s&&2!==s)if(2===s)d=function(e){return o(h,e),n.value};else{var g=0===s||1===s;(g||3===s)&&(d=c?function(e){return o(h,e),n.get.call(e)}:function(e){return n.get.call(e)}),(g||4===s)&&(p=c?function(e,t){o(h,e),n.set.call(e,t)}:function(e,t){n.set.call(e,t)})}else d=function(e){return e[r]},0===s&&(p=function(e,t){e[r]=t});var b=c?h.bind():function(e){return r in e};v.access=d&&p?{get:d,set:p,has:b}:d?{get:d,has:b}:{set:p,has:b};try{return e.call(t,u,v)}finally{m.v=!0}}function l(e,t){if("function"!=typeof e)throw new TypeError(t+" must be a function")}function c(e,t){var r=(0,n.Z)(t);if(1===e){if("object"!==r||null===t)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&l(t.get,"accessor.get"),void 0!==t.set&&l(t.set,"accessor.set"),void 0!==t.init&&l(t.init,"accessor.init")}else if("function"!==r)throw new TypeError((0===e?"field":5===e?"class":"method")+" decorators must return a function or void 0")}function u(e){return function(){return e(this)}}function h(e){return function(t){e(this,t)}}function f(e,t,r,n,a,i,o,l,f,d){var p,v,m,g,b,y,w=r[0];n||Array.isArray(w)||(w=[w]),l?p=0===i||1===i?{get:u(r[3]),set:h(r[4])}:3===i?{get:r[3]}:4===i?{set:r[3]}:{value:r[3]}:0!==i&&(p=Object.getOwnPropertyDescriptor(t,a)),1===i?m={get:p.get,set:p.set}:2===i?m=p.value:3===i?m=p.get:4===i&&(m=p.set);for(var Z=n?2:1,k=w.length-1;k>=0;k-=Z){var E;void 0!==(g=s(w[k],n?w[k-1]:void 0,a,p,f,i,o,l,m,d))&&(c(i,g),0===i?E=g:1===i?(E=g.init,b=g.get||m.get,y=g.set||m.set,m={get:b,set:y}):m=g,void 0!==E&&(void 0===v?v=E:"function"==typeof v?v=[v,E]:v.push(E)))}if(0===i||1===i){if(void 0===v)v=function(e,t){return t};else if("function"!=typeof v){var S=v;v=function(e,t){for(var r=t,n=S.length-1;n>=0;n--)r=S[n].call(e,r);return r}}else{var j=v;v=function(e,t){return j.call(e,t)}}e.push(v)}0!==i&&(1===i?(p.get=m.get,p.set=m.set):2===i?p.value=m:3===i?p.get=m:4===i&&(p.set=m),l?1===i?(e.push((function(e,t){return m.get.call(e,t)})),e.push((function(e,t){return m.set.call(e,t)}))):2===i?e.push(m):e.push((function(e,t){return m.call(e,t)})):Object.defineProperty(t,a,p))}function d(e,t,r){for(var n,i,o,s=[],l=new Map,c=new Map,u=0;u<t.length;u++){var h=t[u];if(Array.isArray(h)){var d,v,m=h[1],g=h[2],b=h.length>3,y=16&m,w=!!(8&m),Z=r;if(m&=7,w?(d=e,0!==m&&(v=i=i||[]),b&&!o&&(o=function(t){return(0,a.Z)(t)===e}),Z=o):(d=e.prototype,0!==m&&(v=n=n||[])),0!==m&&!b){var k=w?c:l,E=k.get(g)||0;if(!0===E||3===E&&4!==m||4===E&&3!==m)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+g);k.set(g,!(!E&&m>2)||m)}f(s,d,h,y,g,m,w,b,v,Z)}}return p(s,n),p(s,i),s}function p(e,t){t&&e.push((function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e}))}function v(e,t,r,n,a){return{e:d(e,t,a),get c(){return function(e,t,r){if(t.length){for(var n=[],a=e,o=e.name,s=r?2:1,l=t.length-1;l>=0;l-=s){var u={v:!1};try{var h=t[l].call(r?t[l-1]:void 0,a,{kind:"class",name:o,addInitializer:i(n,u)})}finally{u.v=!0}void 0!==h&&(c(5,h),a=h)}return[a,function(){for(var e=0;e<n.length;e++)n[e].call(a)}]}}(e,r,n)}}}},1815:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(6522);function a(e){if(Object(e)!==e)throw TypeError("right-hand side of 'in' should be an object, got "+(null!==e?(0,n.Z)(e):"null"));return e}},5863:(e,t,r)=>{function n(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}r.d(t,{Z:()=>n})},175:(e,t,r)=>{function n(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}r.d(t,{Z:()=>n})},687:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(175);function a(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,(0,n.Z)(e,t,"get"))}},3395:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(5863);function a(e,t,r){(0,n.Z)(e,t),t.set(e,r)}},381:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(175);function a(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,(0,n.Z)(e,t,"set"),r),r}},6666:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(5850);function a(e,t,r){return(t=(0,n.Z)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},7896:(e,t,r)=>{function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}r.d(t,{Z:()=>n})},3028:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(6666);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}},5850:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(6522);function a(e){var t=function(e,t){if("object"!==(0,n.Z)(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,"string");if("object"!==(0,n.Z)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===(0,n.Z)(t)?t:String(t)}},6522:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}r.d(t,{Z:()=>n})},1391:(e,t,r)=>{r.d(t,{G:()=>x});var n,a,i,o,s,l,c,u,h=r(3395),f=r(381),d=r(687),p=r(2604),v=r(1218),m=r(3105),{method:g,property:b}=(0,v.createDecorators)();n=b({attribute:!1}),i=b({attribute:!1}),s=g(),l=g();var y=new WeakMap,w=new WeakMap,Z=new WeakMap,k=new WeakMap,E=new WeakMap,S=new WeakMap,j=new WeakMap,O=new WeakMap;class x extends m.ReactNextElement{constructor(){super(...arguments),(0,h.Z)(this,S,{get:F,set:I}),(0,h.Z)(this,k,{get:M,set:N}),(0,h.Z)(this,w,{get:B,set:C}),(0,h.Z)(this,y,{writable:!0,value:!1}),(0,h.Z)(this,Z,{writable:!0,value:"normal"}),(0,h.Z)(this,E,{writable:!0,value:!1}),(0,h.Z)(this,j,{writable:!0,value:(c(this),a(this))}),(0,h.Z)(this,O,{writable:!0,value:o(this)})}get isFormItemElement(){return!0}set validateState(e){(0,f.Z)(this,k,e),this._render()}get validateState(){return(0,d.Z)(this,k)}set notRender(e){this.hidden=e,(0,f.Z)(this,w,e),this._render()}get notRender(){return(0,d.Z)(this,w)}get $bindFormItem(){return(0,d.Z)(this,S)}set $bindFormItem(e){(0,f.Z)(this,S,e),this._render()}get helpBrick(){return(0,d.Z)(this,j)}set helpBrick(e){(0,f.Z)(this,j,e)}get labelBrick(){return(0,d.Z)(this,O)}set labelBrick(e){(0,f.Z)(this,O,e)}setNotRender(e){this.notRender=e}getFormElement(){for(var e=this;(e=e.parentNode)&&e&&!e.isFormElement;);return e}}function B(){return(0,d.Z)(this,y)}function C(e){(0,f.Z)(this,y,e)}function M(){return(0,d.Z)(this,Z)}function N(e){(0,f.Z)(this,Z,e)}function F(){return(0,d.Z)(this,E)}function I(e){(0,f.Z)(this,E,e)}u=x,[a,o,c]=(0,p.Z)(u,[[n,1,"helpBrick"],[i,1,"labelBrick"],[s,2,"setNotRender"],[l,2,"getFormElement"]],[]).e}}]);
//# sourceMappingURL=eo-dynamic-form-item.5b7b57a3.js.map