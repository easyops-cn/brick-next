/*! For license information please see 5009.82f3a2ca.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_next_bricks_basic=globalThis.webpackChunk_next_bricks_basic||[]).push([[5009],{2559:(e,t,n)=>{function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}n.d(t,{A:()=>r})},2016:(e,t,n)=>{function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}n.d(t,{A:()=>r})},829:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t){return e.get((0,r.A)(e,t))}},918:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t,n){(0,r.A)(e,t),t.set(e,n)}},6121:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2559);function o(e,t,n){return e.set((0,r.A)(e,t),n),n}},4635:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(2016);function o(e,t){(0,r.A)(e,t),t.add(e)}},4586:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(1369);function o(e,t,n){return(t=(0,r.A)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1369:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(7545);function o(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=(0,r.A)(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==(0,r.A)(t)?t:t+""}},7545:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},5009:(e,t,n)=>{n.r(t),n.d(t,{Dialog:()=>Yt,Notification:()=>rn,StoryboardFunctionRegistryFactory:()=>pe,__secret_internals:()=>r,__test_only:()=>{},applyTheme:()=>te,authenticate:()=>Ta,batchSetAppsLocalTheme:()=>ne,checkIfByTransform:()=>St,checkIfOfComputed:()=>Et,createHistory:()=>A,createRuntime:()=>ba,customEditors:()=>La,customProcessors:()=>M,customTemplates:()=>Pe,fetchByProvider:()=>$a,getAuth:()=>_a,getBasePath:()=>p,getCssPropertyValue:()=>ce,getCurrentMode:()=>ie,getCurrentTheme:()=>ee,getHistory:()=>k,getPageInfo:()=>co,getRealValue:()=>Na,getRuntime:()=>ya,getV2RuntimeFromDll:()=>S,handleHttpError:()=>nn,httpErrorToString:()=>Jt,isLoggedIn:()=>xa,isUnauthenticatedError:()=>Qt,logout:()=>Pa,matchPath:()=>$t,registerWidgetFunctions:()=>Be,registerWidgetI18n:()=>N,setUIVersion:()=>uo,unstable_createRoot:()=>Ba});var r={};n.r(r),n.d(r,{addRealTimeDataInspectHook:()=>Tr,debugDataValue:()=>kr,getAddedContracts:()=>Ar,getAllContextValues:()=>br,getBrickPackagesById:()=>yr,getContextValue:()=>vr,getLegalRuntimeValue:()=>Ir,getRenderId:()=>Sr,legacyDoTransform:()=>cr,loadBricks:()=>wr,loadEditors:()=>Er,mountUseBrick:()=>ir,renderUseBrick:()=>ar,setRealTimeDataInspectRoot:()=>Or,symbolForRootRuntimeContext:()=>or,unmountUseBrick:()=>sr,updateSnippetPreviewSettings:()=>mr,updateStoryboard:()=>lr,updateStoryboardByRoute:()=>ur,updateStoryboardBySnippet:()=>hr,updateStoryboardByTemplate:()=>dr,updateTemplatePreviewSettings:()=>fr});var o=n(4586),a=n(918),i=n(6121),s=n(829),c=n(3241),l=n(5096),u=n(4218),d=n(1302),f=(n(6036),n(2890));function p(){const e=document.querySelector("base");return e?e.getAttribute("href"):"/"}var h=n(1030);function m(e,t){const n=(0,h.orderBy)(e,(e=>{var t;return(null===(t=e.app.homepage)||void 0===t?void 0:t.length)??0}),"desc");for(const e of n){const n=e.app.homepage;if("string"==typeof n&&"/"===n[0]&&g(n,t))return e}}function g(e,t){return"/"===e?t===e:`${t.replace(/\/+$/,"")}/`.startsWith(`${e.replace(/\/+$/,"")}/`)}function v(e){var t;return!e||(null===(t=ya().getCurrentApp())||void 0===t?void 0:t.id)!==e.app.id&&!window.STANDALONE_MICRO_APPS&&e.app.standaloneMode}let b,y=!1;function w(e,t){y=!confirm(e),t(!y)}function E(e){const{push:t,replace:n}=e;function r(r){return function(o,a,i){let s;const c="string"==typeof o;return s=c?(0,f.parsePath)(o).pathname:o.pathname,"string"==typeof s&&s.startsWith("/")&&v(function(e){var t;return m((null===(t=ha)||void 0===t?void 0:t.storyboards)??[],e)}(s))?location["push"===r?"assign":"replace"](c?p()+o.substring(1):e.createHref(o)):("push"===r?t:n)(o,a,i)}}return{push:r("push"),replace:r("replace")}}function S(){var e;const{dll:t}=window;if(t&&null!==(e=window.BRICK_NEXT_VERSIONS)&&void 0!==e&&null!==(e=e["brick-container"])&&void 0!==e&&e.startsWith("2."))return t("tYg3")}function A(){if(!b){const e=(0,f.createBrowserHistory)({basename:p().replace(/\/$/,""),getUserConfirmation:w});Object.assign(e,function(e){const{push:t,replace:n}=e;function r(e,n,r){y=!1,t(e,n),null==r||r(y)}function o(e,t,r){y=!1,n(e,t),null==r||r(y)}function a(t){return function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const{extraQuery:s,clear:c,keepHash:l,...u}=a,d=new URLSearchParams(c?"":e.location.search),f={};Object.assign(f,n,s);for(const[e,t]of Object.entries(f))if(Array.isArray(t)){d.delete(e);for(const n of t)d.append(e,n)}else null==t||""===t?d.delete(e):d.set(e,t);("push"===t?r:o)(`?${d.toString()}${l?e.location.hash:""}`,u,i)}}let i;return{pushQuery:a("push"),replaceQuery:a("replace"),pushAnchor:function(t,n,o){r({...e.location,key:void 0,hash:t,state:{notify:!1,...n}},void 0,o)},reload:function(t){o({...e.location,state:{...e.location.state,notify:!0,noIncremental:!0}},void 0,t)},setBlockMessage:function(e){i=e},getBlockMessage:function(){return i},unblock:function(){i=void 0},...E({...e,push:r,replace:o})}}(e)),b=e}return b}const k=function(){const e=S();if(e)return e.getHistory}()||function(){return b};var I=n(4635),C=n(2559),R=n(8255),O=n(3136),T=n(4130),_=n(9080),P=n(8502),x=new WeakMap;const M=function(){const e=S();if(e)return Object.freeze({define:(t,n)=>e.getRuntime().registerCustomProcessor(t,n)})}()||new class{constructor(){(0,a.A)(this,x,new Map)}define(e,t){const[n,r]=e.split(".");let o=(0,s.A)(x,this).get(n);if(o||(o=new Map,(0,s.A)(x,this).set(n,o)),o.has(r))throw new Error(`Custom processor of "${e}" already registered`);o.set(r,t)}get(e){return(0,s.A)(x,this).get(e)}};function L(e){let{app:t,meta:n}=e;if(null!=n&&n.i18n){const e=$("app",t.id),r=[];return Object.entries(n.i18n).forEach((t=>{let[n,o]=t;c.i18n.addResourceBundle(n,e,o),r.push(n)})),()=>{for(const t of r)c.i18n.removeResourceBundle(t,e)}}}function $(e,t){return`${e}/${t}`}function B(e){return c.i18n.getFixedT(null,$("widget",e))}const N=function(){const e=S();if(e)return function(t,n){return e.getRuntime().registerWidgetI18n(t,n)}}()||function(e,t){const n=$("widget",e);Object.entries(t).forEach((e=>{let[t,r]=e;c.i18n.addResourceBundle(t,n,r)}))},U="brick-next-devtools-panel",F="devtools-frame-active-change",j="devtools-panel-change";let D,K=!0;function V(e,t){const n=W();if(!n||"evaluation"===e&&(!K||D&&"Evaluations"!==D))return;const r=()=>{var r;null===(r=n.emit)||void 0===r||r.call(n,{type:e,payload:t})};"function"==typeof window.requestIdleCallback?window.requestIdleCallback(r):setTimeout(r,0)}function W(){return window.__BRICK_NEXT_DEVTOOLS_HOOK__}const H=()=>{throw new Error("Can't modify read-only proxy object")},z={set:H,defineProperty:H,deleteProperty:H,setPrototypeOf:H};function G(e){return new Proxy(e,z)}function q(e){let{get:t,ownKeys:n}=e;return W()?G(Object.fromEntries(n(null).map((e=>[e,t(null,e,null)])))):new Proxy(Object.freeze({}),{get:t})}let Y="light";const X=new u.JsonStorage(localStorage),J="apps-theme";function Q(e){if("dark"!==e&&"light"!==e&&"dark-v2"!==e)throw new Error(`Unsupported theme: ${e}`);Y=e}function Z(){return Y}function ee(){return document.documentElement.dataset.theme}function te(e){e?Q(e):e=Z(),e!==ee()&&(document.documentElement.dataset.theme=e,window.dispatchEvent(new CustomEvent("theme.change",{detail:e})))}function ne(e){X.setItem(J,{...re(),...e})}function re(){let e;try{e=X.getItem(J)}catch{console.error("JSON parse error inside `getLocalAppsTheme()`")}return e??{}}let oe="default";function ae(e){if("dashboard"!==e&&"default"!==e)throw new Error(`Unsupported mode: ${e}`);oe=e}function ie(){return document.documentElement.dataset.mode}function se(e){e?ae(e):e=oe,e!==ie()&&(document.documentElement.dataset.mode=e,window.dispatchEvent(new CustomEvent("mode.change",{detail:e})))}function ce(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.documentElement;return n&&(null===(t=window.getComputedStyle(n))||void 0===t?void 0:t.getPropertyValue(e))||""}function le(e,t){const n={};for(const r of e){const e=ue(r,t);void 0!==e&&(n[r]=e)}return n}function ue(e,t){var n,r,o;let{collectCoverage:a,widgetId:i,widgetVersion:s,app:l,appendI18nNamespace:u,storyboardFunctions:d,isStoryboardFunction:f}=t;switch(e){case"BASE_URL":return a?"/next":p().replace(/\/$/,"");case"FN":return d;case"IMG":return a?{get:e=>`mock/images/${e}`}:i?null==va||null===(n=va.images)||void 0===n?void 0:n.widgetImagesFactory(i,s):null==va||null===(r=va.images)||void 0===r?void 0:r.imagesFactory(l.id,l.isBuildPush,l.currentVersion);case"I18N":return a?h.identity:i?B(i):c.i18n.getFixedT(null,[u,$("app",l.id)].filter(Boolean));case"I18N_TEXT":return a?de:c.i18nText;case"PERMISSIONS":return G({check:a?fe:null==va||null===(o=va.checkPermissions)||void 0===o?void 0:o.checkPermissions});case"THEME":return G({getTheme:a?()=>"light":Z});case"console":return f?G(console):void 0;case"location":return a?{href:"http://localhost:3000/functions/test",origin:"http://localhost:3000",host:"localhost:3000",hostname:"localhost"}:{href:location.href,origin:location.origin,host:location.host,hostname:location.hostname}}}function de(e){return null==e?void 0:e.en}function fe(){return!0}function pe(){let{widgetId:e,widgetVersion:t,collectCoverage:n,debuggerOverrides:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=new Map,a=null==r?void 0:r({precookFunction:O.precookFunction,cook:O.cook,supply:P.supply}),i=new Proxy(Object.freeze({}),{get:(c,l)=>function(c){const l=o.get(c);if(!l)return;if(l.processed)return l.cooked;let u;n&&(u=n.createCollector(c));const d=(0,O.precookFunction)(l.source,{typescript:l.typescript,hooks:u&&{beforeVisit:u.beforeVisit},cacheKey:l}),f=(0,P.supply)(d.attemptToVisitGlobals,le(d.attemptToVisitGlobals,{collectCoverage:n,widgetId:e,widgetVersion:t,app:s,storyboardFunctions:i,isStoryboardFunction:!0}),!!n);return l.cooked=(0,O.cook)(d.function,l.source,{rules:{noVar:!0},globalVariables:a?{...f,...null!=a&&a.LodashWithStaticFields&&d.attemptToVisitGlobals.has("_")?{_:{...f._,...a.LodashWithStaticFields}}:null,...null!=a&&a.ArrayConstructor&&d.attemptToVisitGlobals.has("Array")?{Array:a.ArrayConstructor}:null,...null!=a&&a.ObjectWithStaticFields&&d.attemptToVisitGlobals.has("Object")?{Object:{...f.Object,...a.ObjectWithStaticFields}}:null}:f,ArrayConstructor:null==a?void 0:a.ArrayConstructor,hooks:u&&{beforeEvaluate:u.beforeEvaluate,beforeCall:u.beforeCall,beforeBranch:u.beforeBranch},debug:!!r}),l.processed=!0,l.cooked}(l)});let s;return{storyboardFunctions:i,registerStoryboardFunctions:function(e,t){if(t&&(s=t),o.clear(),Array.isArray(e))for(const t of e){let e=t.deps;null==e&&(e=(0,T.collectMemberUsageInFunction)(t,"FN",!!n),e.delete(t.name));const r=t.perm??(0,T.collectMemberUsageInFunction)(t,"PERMISSIONS",!!n).has("check");o.set(t.name,{source:t.source,typescript:t.typescript,deps:e,hasPermissionsCheck:r})}},updateStoryboardFunction(e,t){const n={...t,name:e},r=(0,T.collectMemberUsageInFunction)(n,"FN",!0),a=(0,T.collectMemberUsageInFunction)(n,"PERMISSIONS",!0).has("check");o.set(e,{source:t.source,typescript:t.typescript,deps:r,hasPermissionsCheck:a})},checkPermissionsUsage(e){const t=new Set,n=e=>{if(!t.has(e)){t.add(e);const r=o.get(e);return!!r&&(r.hasPermissionsCheck||[...r.deps].some(n))}return!1};return e.some(n)},clearGlobalExecutionContextStack(){(0,O.__dev_only_clearGlobalExecutionContextStack)()},getGlobalExecutionContextStack:()=>(0,O.__dev_only_getGlobalExecutionContextStack)()}}const{storyboardFunctions:he,registerStoryboardFunctions:me,checkPermissionsUsage:ge}=pe();var ve={};try{ve.EventTarget=(new EventTarget).constructor}catch(e){!function(e,t){var n=e.create,r=e.defineProperty,o=a.prototype;function a(){t.set(this,n(null))}function i(e,t,n){r(e,t,{configurable:!0,writable:!0,value:n})}function s(e){var t=e.options;return t&&t.once&&e.target.removeEventListener(this.type,e.listener),"function"==typeof e.listener?e.listener.call(e.target,this):e.listener.handleEvent(this),this._stopImmediatePropagationFlag}i(o,"addEventListener",(function(e,n,r){for(var o=t.get(this),a=o[e]||(o[e]=[]),i=0,s=a.length;i<s;i++)if(a[i].listener===n)return;a.push({target:this,listener:n,options:r})})),i(o,"dispatchEvent",(function(e){var n=t.get(this)[e.type];return n&&(i(e,"target",this),i(e,"currentTarget",this),n.slice(0).some(s,e),delete e.currentTarget,delete e.target),!0})),i(o,"removeEventListener",(function(e,n){for(var r=t.get(this),o=r[e]||(r[e]=[]),a=0,i=o.length;a<i;a++)if(o[a].listener===n)return void o.splice(a,1)})),ve.EventTarget=a}(Object,new WeakMap)}const be=ve.EventTarget;let ye=function(e){return e.xLarge="xLarge",e.large="large",e.medium="medium",e.small="small",e.xSmall="xSmall",e}({});const we=new Map([[ye.xLarge,"1920px"],[ye.large,"1600px"],[ye.medium,"1280px"],[ye.small,"1024px"],[ye.xSmall,0]]),Ee=new be,Se={},Ae={};function ke(e,t){let n=!1;Se[t]=e.matches;for(const[e]of we)if(Se[e]&&Ae.breakpoint!==e){Ae.breakpoint=e,n=!0;break}n&&Ee.dispatchEvent(new CustomEvent("change",{detail:Ae}))}we.forEach(((e,t)=>{const n=window.matchMedia(`(min-width: ${e})`);ke(n,t),n.addEventListener?n.addEventListener("change",(e=>{ke(e,t)})):n.addListener((e=>{ke(e,t)}))}));const Ie=()=>Ae;function Ce(e){return function(t){const n="local"===e?localStorage:sessionStorage;return JSON.parse(n.getItem(t)??"null")}}function Re(e){var t,n;return!(null===(t=e?e.flags:null===(n=ya())||void 0===n?void 0:n.getFeatureFlags())||void 0===t||!t["brick-next-v3-strict-mode"])}function Oe(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];const a=0===r.length?"":",";e?console.error(`${t} is dropped in v3 strict mode${a}`,...r):console.warn(`${t} is deprecated in v3 and will be dropped in strict mode${a}`,...r)}const Te=new Set(["prefix"]);var _e=new WeakMap;const Pe=function(){const e=S();if(e)return Object.freeze({define:(t,n)=>e.getRuntime().registerCustomTemplate(t,n)})}()||new class{constructor(){(0,a.A)(this,_e,new Map)}define(e,t){var n,r;let o=(0,s.A)(_e,this).has(e);o?console.warn(`Custom template of "${e}" already registered.`):(o=!!customElements.get(e),o&&console.warn(`Custom template of "${e}" already defined by customElements.`));const a=Re(),i=(null===(n=t.proxy)||void 0===n?void 0:n.properties)??{},c=[],l=[];for(const[t,n]of Object.entries(i))n.asVariable?(Oe(a,"Template `asVariable`",e,t),a||l.push(t)):n.mergeProperty||n.refTransform?console.error("Template `mergeProperty` and `refTransform` are dropped in v3:",e,t):n.ref&&c.push([t,n]);const u={...t,proxy:{...t.proxy,properties:Object.fromEntries(c)},state:(t.state?a?t.state:t.state.map((e=>({expose:!0,...e}))):[]).concat(l.map((e=>({name:e,expose:!0}))))};(0,s.A)(_e,this).set(e,{...u,name:e});const d=(f=u.state,(0,h.uniq)((null==f?void 0:f.filter((e=>e.expose)).map((e=>e.name)))??[]));var f;const p=Object.entries((null===(r=u.proxy)||void 0===r?void 0:r.methods)??{}),m=d.concat(c.map((e=>e[0]))),g=p.map((e=>e[0])),v=m.concat(g).filter((e=>e in HTMLElement.prototype&&!Te.has(e)));if(v.length>0&&(Oe(a,"Using native HTMLElement properties as template properties or methods",e,...v),a))throw new Error(`In custom template "${e}", ${v.map((e=>`"${e}"`)).join(", ")} are native HTMLElement properties, and should be avoid to be used as brick properties or methods.`);if(!o){class t extends HTMLElement{get $$typeof(){return"custom-template"}static get _dev_only_definedProperties(){return m}static get _dev_only_definedMethods(){return g}$$getElementByRef(e){var t;return null===(t=this.$$tplStateStore)||void 0===t||null===(t=t.hostBrick)||void 0===t||null===(t=t.tplHostMetadata)||void 0===t||null===(t=t.internalBricksByRef.get(e))||void 0===t?void 0:t.element}connectedCallback(){let e=this.shadowRoot;e||(e=this.attachShadow({mode:"open"}));const t=document.createDocumentFragment(),n=document.createElement("style");n.textContent=":host{display:block}:host([hidden]){display:none}";const r=document.createElement("slot");t.appendChild(n),t.appendChild(r),e.appendChild(t)}disconnectedCallback(){this.shadowRoot&&(this.shadowRoot.textContent="")}}for(const n of d)c.some((e=>e[0]===n))?console.error(`Cannot define an exposed state that is also a proxy property: "${n}" in ${e}`):Object.defineProperty(t.prototype,n,{get(){return this.$$tplStateStore.getValue(n)},set(e){var t;null===(t=this.$$tplStateStore)||void 0===t||t.updateValue(n,e,"replace")},enumerable:!0});for(const[e,n]of c)Object.defineProperty(t.prototype,e,{get(){return this.$$getElementByRef(n.ref)[n.refProperty??e]},set(t){var r;const o=null===(r=this.$$getElementByRef)||void 0===r?void 0:r.call(this,n.ref);o&&(o[n.refProperty??e]=t)},enumerable:!0});for(const[e,n]of p)Object.defineProperty(t.prototype,e,{value(){return this.$$getElementByRef(n.ref)[n.refMethod??e](...arguments)},enumerable:!0});customElements.define(e,t)}}get(e){return(0,s.A)(_e,this).get(e)}};function xe(e,t,n){let{tplStateStoreId:r,tplStateStoreMap:o}=e;if(!r)throw new Error(`Using "${t}" outside of a custom template${n??""}`);const a=o.get(r);if(!a)throw new Error(`Template state store is not found when using "${t}"${n??""}.\nThis is a bug of Brick Next, please report it.`);return a}function Me(e,t,n){const r=xe(e,t,n).hostBrick.element;if(!r)throw new Error(`Template host element is gone when using "${t}"${n??""}.\nThis is a bug of Brick Next, please report it.`);return r}const Le=new Map,$e=new Proxy(Object.freeze({}),{get:(e,t)=>Le.get(t)}),Be=function(){const e=S();if(e)return function(t,n,r){return e.getRuntime().registerWidgetFunctions(t,n,r)}}()||function(e,t,n){if(Le.has(e))throw new Error(`Widget functions of "${e}" already registered`);const{storyboardFunctions:r,registerStoryboardFunctions:o}=pe({widgetId:e,widgetVersion:n});Le.set(e,r),o(t)},Ne=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Ue=e=>{if("string"!=typeof e)throw new TypeError("Invalid argument expected string");const t=e.match(Ne);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},Fe=e=>"*"===e||"x"===e||"X"===e,je=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},De=(e,t)=>{if(Fe(e)||Fe(t))return 0;const[n,r]=((e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t])(je(e),je(t));return n>r?1:n<r?-1:0},Ke=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const r=De(e[n]||"0",t[n]||"0");if(0!==r)return r}return 0},Ve=(e,t,n)=>{ze(n);const r=((e,t)=>{const n=Ue(e),r=Ue(t),o=n.pop(),a=r.pop(),i=Ke(n,r);return 0!==i?i:o&&a?Ke(o.split("."),a.split(".")):o||a?o?-1:1:0})(e,t);return We[n].includes(r)},We={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},He=Object.keys(We),ze=e=>{if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===He.indexOf(e))throw new Error(`Invalid operator, expected one of ${He.join("|")}`)};function Ge(e,t){let n=Oa(e);if(!n&&null!=va&&va.checkInstalledApps&&(n=va.checkInstalledApps.getCheckedApp(e)),!n||"running"===n.installStatus)return!1;if(!t||!n.currentVersion)return!0;const r=t.match(/^([><]=?|=)(.*)$/);try{if(!r)throw new TypeError(`Invalid match version: ${t}`);return Ve(n.currentVersion,r[2],r[1])}catch(e){console.error(e)}return!1}function qe(e,t,n){let{formStateStoreId:r,formStateStoreMap:o}=e;if(!r)throw new Error(`Using "${t}" outside of form renderer${n??""}`);const a=o.get(r);if(!a)throw new Error(`Form state store is not found when using "${t}"${n??""}.\nThis is a bug of Brick Next, please report it.`);return a}const Ye=new Map;async function Xe(e){var t;const n=null==va||null===(t=va.flowApi)||void 0===t?void 0:t.isFlowApiProvider(e);n&&(e=va.flowApi.FLOW_API_PROVIDER);let r=Ye.get(e);if(r)return r;if(e.includes("-")&&!customElements.get(e))if(n)va.flowApi.registerFlowApiProvider();else if(await(0,l.loadBricksImperatively)([e],Aa()),!customElements.get(e))throw new Error(`Provider not defined: "${e}".`);return r=document.createElement(e),Ye.set(e,r),r}let Je=new WeakSet;function Qe(e){if((0,u.isObject)(e)&&!Ze(e))if(Je.add(e),Array.isArray(e))e.forEach(Qe);else{const t=Object.getPrototypeOf(e);t&&t.constructor!==Object||Object.values(e).forEach(Qe)}}function Ze(e){return Je.has(e)}const et=new Map;async function tt(e,t,n){const{useProvider:r,method:o="resolve",args:a=[],onReject:i}=e,{provider:s,field:c}=e;if(s&&!r)throw new Error(`You're using "provider: ${s}" which is dropped in v3, please use "useProvider" instead`);const l=null!=c;if(l){const e=Re();if(Oe(e,"`resolve.field`"),e)throw new Error("Using deprecated `resolve.field`")}const[u,d]=await Promise.all([Xe(r),mt(a,t)]),f=null==n?void 0:n.renderId,p=nt(u,r,o,d,n,a,!!f&&f!==Ia());let m,{transform:g}=e;try{const e=await p;m=l?(0,h.get)(e,c):e,Qe(m)}catch(e){if(!function(e){return!(null==e||!e.transform)}(i))throw e;g=i.transform,m=e}return g?"string"==typeof g?{[g]:m}:mt(g,{...t,data:m}):m}async function nt(e,t,n,r,o,a,i){let s,c;try{s=JSON.stringify({useProvider:t,method:n,args:r})}catch(e){if(!a)throw e;s=JSON.stringify({useProvider:t,method:n,originalArgs:a})}return"reload"!==(null==o?void 0:o.cache)&&(c=et.get(s)),c||(c=(async o=>{const a=null!=va&&null!==(o=va.flowApi)&&void 0!==o&&o.isFlowApiProvider(t)?await va.flowApi.getArgsOfFlowApi(t,r,n):r;return e[n](...a)})(),i||et.set(s,c)),c}const rt=Symbol.for("pre.evaluated.raw"),ot=Symbol.for("pre.evaluated.context");function at(e){return!(null==e||!e[rt])}function it(e){return e[rt]}function st(e){return"string"==typeof e?(0,O.shouldAllowRecursiveEvaluations)(e):(0,O.shouldAllowRecursiveEvaluations)(e[rt])}const ct=new WeakSet([SyntaxError,TypeError,ReferenceError]);function lt(e){return ct.has(e.constructor)?e.constructor:TypeError}function ut(e,t,n){const{run:r}=dt(e,t,n,!1);return r()}function dt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const o=[];if("string"!=typeof e){const n=(0,h.omit)(t,["pendingPermissionsPreCheck","tplStateStoreMap","tplStateStoreScope","formStateStoreMap","formStateStoreScope"]);t={...e[ot],...n},e=e[rt]}const a={usedArgs:new Set},i={usedArgs:new Set};let s;try{s=(0,O.preevaluate)(e,{cache:!0,withParent:!0,hooks:{beforeVisitGlobal(e,t){(0,T.collectAppGetMenuUsage)(a,e,t),(0,T.collectInstalledAppsHasUsage)(i,e,t)}}})}catch(t){const n=`${t.message}, in "${e}"`;throw new(lt(t))(n)}if(a.hasNonStaticUsage)throw new Error(`Non-static usage of "APP.getMenu" is prohibited in v3, check your expression: "${e}"`);if(i.hasNonStaticUsage)throw new Error(`Non-static usage of "INSTALLED_APPS.has" is prohibited in v3, check your expression: "${e}"`);const c={},{attemptToVisitGlobals:d}=s;if(n.lazy||d.has("EVENT")&&!(0,u.hasOwnProperty)(t,"event")||d.has("DATA")&&!(0,u.hasOwnProperty)(t,"data"))return{blockingList:o,run:()=>Object.keys(t).length>0?{[rt]:e,[ot]:t}:e};let f,p,m,g;const v=Re(t);let b,y;(d.has("STATE")||!v&&d.has("TPL"))&&(g=xe(t,"STATE",`: "${e}"`)),d.has("FORM_STATE")&&(y=qe(t,"FORM_STATE",`: "${e}"`));const w=W();if(r||w){if(d.has("CTX")&&(f=(0,T.strictCollectMemberUsage)(e,"CTX"),r&&o.push(t.ctxStore.waitFor(f))),g){if(m=(0,T.strictCollectMemberUsage)(e,"STATE"),!v){const t=(0,T.strictCollectMemberUsage)(e,"TPL");for(const e of t)m.add(e)}r&&o.push(g.waitFor(m))}y&&(b=(0,T.strictCollectMemberUsage)(e,"FORM_STATE"),r&&o.push(y.waitFor(b))),d.has("PROCESSORS")&&(p=(0,T.strictCollectMemberUsage)(e,"PROCESSORS",2),r&&o.push((0,l.loadProcessorsImperatively)(p,Aa())))}if(r){let n=d.has("PERMISSIONS");if(!n&&d.has("FN")){const t=[...(0,T.strictCollectMemberUsage)(e,"FN")];n=ge(t)}if(n&&o.push(...t.pendingPermissionsPreCheck),a.usedArgs.size>0&&null!=va&&va.menu){const e=[...a.usedArgs];o.push(Promise.all(e.map((e=>va.menu.fetchMenuById(e,t,{getStoryboardByAppId:Ra,resolveData:tt,asyncComputeRealValue:mt})))))}var E;i.usedArgs.size>0&&o.push(null==va||null===(E=va.checkInstalledApps)||void 0===E?void 0:E.waitForCheckingApps([...i.usedArgs]))}return{blockingList:o,run(){var n,r;const{app:o,location:a,query:i,match:l,flags:w,sys:E,ctxStore:S,data:A,event:k}=t,I=t.overrideApp??o;for(const o of d)switch(o){case"ANCHOR":c[o]=a.hash?a.hash.substring(1):null;break;case"APP":if(null==I)throw new ReferenceError(`APP is not defined, in "${e}"`);c[o]={...(0,h.cloneDeep)(I),getMenu:null==va||null===(n=va.menu)||void 0===n?void 0:n.getMenuById};break;case"CTX":c[o]=q({get:(e,t)=>S.getValue(t),ownKeys:()=>Array.from(f)});break;case"DATA":c[o]=A;break;case"EVENT":c[o]=k;break;case"FLAGS":c[o]=G(w);break;case"FORM_STATE":c[o]=q({get:(e,t)=>y.getValue(t),ownKeys:()=>Array.from(b)});break;case"HASH":c[o]=a.hash;break;case"INSTALLED_APPS":c[o]=G({has:Ge});break;case"ITEM":case"INDEX":case"SIZE":{const n="ITEM"===o?"forEachItem":"INDEX"===o?"forEachIndex":"forEachSize";(0,u.hasOwnProperty)(t,n)?c[o]=t[n]:console.error(`Using \`${o}\` but no \`:forEach\` is found, check your expression: "${e}"`);break}case"LOCAL_STORAGE":c[o]=G({getItem:Ce("local")});break;case"MEDIA":c[o]=G(Ie());break;case"MISC":c[o]=ya().getMiscSettings();break;case"PARAMS":if(null==i)throw new ReferenceError(`PARAMS is not defined, in "${e}"`);c[o]=new URLSearchParams(i);break;case"PATH":c[o]=G((null==l?void 0:l.params)??{});break;case"PATH_NAME":c[o]=a.pathname;break;case"PROCESSORS":c[o]=q({get(e,t){const n=M.get(t);if(!n)throw new Error(`'PROCESSORS.${t}' is not registered! Have you installed the relevant brick package?`);return q({get:(e,t)=>n.get(t),ownKeys:()=>Array.from(n.keys())})},ownKeys(){const e=new Set;for(const t of p){const n=t.split(".")[0];e.add(n)}return Array.from(e)}});break;case"QUERY":if(null==i)throw new ReferenceError(`QUERY is not defined, in "${e}"`);c[o]=Object.fromEntries(Array.from(i.keys()).map((e=>[e,i.get(e)])));break;case"QUERY_ARRAY":if(null==i)throw new ReferenceError(`QUERY_ARRAY is not defined, in "${e}"`);c[o]=Object.fromEntries(Array.from(i.keys()).map((e=>[e,i.getAll(e)])));break;case"SESSION_STORAGE":c[o]=G({getItem:Ce("session")});break;case"TPL":if(Oe(v,'Using "TPL" in expression',`check your expression: "${e}"`),v)break;case"STATE":c[o]=q({get:(e,t)=>g.getValue(t),ownKeys:()=>Array.from(m)});break;case"SYS":c[o]=G(E??{});break;case"__WIDGET_FN__":c[o]=$e;break;case"__WIDGET_IMG__":c[o]=null==va||null===(r=va.images)||void 0===r?void 0:r.widgetImagesFactory;break;case"__WIDGET_I18N__":c[o]=B}Object.assign(c,le(s.attemptToVisitGlobals,{storyboardFunctions:he,app:I,appendI18nNamespace:t.appendI18nNamespace}));try{const t=(0,O.cook)(s.expression,s.source,{globalVariables:(0,P.supply)(s.attemptToVisitGlobals,c)});return V("evaluation",{raw:e,context:c,result:t}),t}catch(t){const n=`${t.message}, in "${e}"`;throw new(lt(t))(n)}}}}let ft=function(e){return e[e.INITIAL=0]="INITIAL",e[e.USE_BRICK=1]="USE_BRICK",e[e.USE_BRICK_ITEM=2]="USE_BRICK_ITEM",e[e.USE_BRICK_PROPERTIES=3]="USE_BRICK_PROPERTIES",e[e.USE_BRICK_TRANSFORM=4]="USE_BRICK_TRANSFORM",e[e.USE_BRICK_EVENTS=5]="USE_BRICK_EVENTS",e[e.USE_BRICK_IF=6]="USE_BRICK_IF",e[e.USE_BRICK_SLOTS=7]="USE_BRICK_SLOTS",e[e.USE_BRICK_SLOTS_ITEM=8]="USE_BRICK_SLOTS_ITEM",e[e.USE_BRICK_SLOTS_ITEM_BRICKS=9]="USE_BRICK_SLOTS_ITEM_BRICKS",e[e.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM=10]="USE_BRICK_SLOTS_ITEM_BRICKS_ITEM",e[e.USE_BRICK_LIFECYCLE=11]="USE_BRICK_LIFECYCLE",e[e.USE_BRICK_DATA_SOURCE=12]="USE_BRICK_DATA_SOURCE",e}({});function pt(e){switch(e){case ft.USE_BRICK_PROPERTIES:case ft.USE_BRICK_TRANSFORM:case ft.USE_BRICK_EVENTS:case ft.USE_BRICK_IF:case ft.USE_BRICK_LIFECYCLE:case ft.USE_BRICK_DATA_SOURCE:return!0}return!1}function ht(e,t,n){if(pt(e))return e;if(t)switch(e){case ft.USE_BRICK:return ft.USE_BRICK_ITEM;case ft.USE_BRICK_SLOTS_ITEM_BRICKS:return ft.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM}else switch(e){case ft.INITIAL:if("useBrick"===n)return ft.USE_BRICK;break;case ft.USE_BRICK:case ft.USE_BRICK_ITEM:case ft.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM:switch(n){case"properties":return ft.USE_BRICK_PROPERTIES;case"transform":return ft.USE_BRICK_TRANSFORM;case"dataSource":return ft.USE_BRICK_DATA_SOURCE;case"events":return ft.USE_BRICK_EVENTS;case"slots":return ft.USE_BRICK_SLOTS;case"children":return ft.USE_BRICK_SLOTS_ITEM_BRICKS;case"if":return ft.USE_BRICK_IF;case"lifeCycle":return ft.USE_BRICK_LIFECYCLE}break;case ft.USE_BRICK_SLOTS:return ft.USE_BRICK_SLOTS_ITEM;case ft.USE_BRICK_SLOTS_ITEM:if("bricks"===n)return ft.USE_BRICK_SLOTS_ITEM_BRICKS}return ft.INITIAL}async function mt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=at(e);if(r||"string"==typeof e){const o=n.$$lazyForUseBrick&&pt(n.$$stateOfUseBrick);let a,i=o;return r||(0,O.isEvaluable)(e)?(a=await async function(e,t,n){const{blockingList:r,run:o}=dt(e,t,n,!0);return await Promise.all(r),o()}(e,t,{lazy:o}),i=st(e)):a=o?e:((0,u.hasOwnProperty)(t,"data")?n.noInject?_.transform:_.transformAndInject:n.noInject?bt:_.inject)(e,t),i||Qe(a),a}if(!(0,u.isObject)(e)||Ze(e)||"function"==typeof e)return e;if(Array.isArray(e)){const r=vt(n,!0);return Promise.all(e.map((e=>mt(e,t,r))))}return Object.fromEntries((await Promise.all(Object.entries(e).map((e=>{let[r,o]=e;return Promise.all([mt(r,t),mt(o,t,vt(n,!1,r))])})))).concat(n.ignoreSymbols?[]:Object.getOwnPropertySymbols(e).map((t=>[t,e[t]]))))}function gt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=at(e);if(r||"string"==typeof e){const o=n.$$lazyForUseBrick&&pt(n.$$stateOfUseBrick);let a,i=o;return r||(0,O.isEvaluable)(e)?(a=ut(e,t),i=st(e)):a=o?e:((0,u.hasOwnProperty)(t,"data")?n.noInject?_.transform:_.transformAndInject:n.noInject?bt:_.inject)(e,t),i||Qe(a),a}if(!(0,u.isObject)(e)||Ze(e)||"function"==typeof e)return e;if(Array.isArray(e)){const r=vt(n,!0);return e.map((e=>gt(e,t,r)))}return Object.fromEntries(Object.entries(e).map((e=>{let[r,o]=e;return[gt(r,t),gt(o,t,vt(n,!1,r))]})).concat(n.ignoreSymbols?[]:Object.getOwnPropertySymbols(e).map((t=>[t,e[t]]))))}function vt(e,t,n){return e.$$lazyForUseBrick?{...e,$$stateOfUseBrick:ht(e.$$stateOfUseBrick,t,n)}:e}function bt(e){return e}async function yt(e,t){return!(0,u.hasOwnProperty)(e,"if")||!!("string"==typeof e.if||at(e.if)?await mt(e.if,t):e.if)}function wt(e,t){return!(0,u.hasOwnProperty)(e,"if")||!!("string"==typeof e.if||at(e.if)?gt(e.if,t):e.if)}function Et(e){return!(0,u.hasOwnProperty)(e,"if")||!!e.if}const St=function(){const e=S();if(e)return e.looseCheckIfByTransform}()||function(e,t){return wt(e,{data:t})};function At(e){let t=!1,n=!1,r=!1;if("string"==typeof e?(0,O.isEvaluable)(e):at(e)){const o="string"==typeof e?e:it(e);if((0,O.isTrackAll)(o)){const e=(0,T.trackAll)(o);e&&(t=e.context,n=e.state,r=e.formState)}else t=(0,T.track)(o,"track context","CTX"),n=(0,T.track)(o,"track state","STATE"),r=(0,T.track)(o,"track formstate","FORM_STATE")}return{contextNames:t,stateNames:n,formStateNames:r}}async function kt(e,t){for(const[n,r,o]of e)if(n===t){const e=await r;if(void 0!==e||!o)return e}}async function It(e){const t={};for(const[n,r,o]of e){const e=await r;void 0===e&&o||!("style"!==n&&"dataset"!==n||(0,u.isObject)(e))||(t[n]=e)}return t}function Ct(e,t){if(t)for(const[n,r]of Object.entries(t))switch(n){case"style":case"dataset":for(const[t,o]of Object.entries(r))e[n][t]=o;break;case"constructor":case"__proto__":case"innerHTML":throw new Error(`set \`${n}\` is prohibited`);default:e[n]=r}}function Rt(e,t,n){const r=function(e,t){return(0,u.isObject)(e)?Object.fromEntries(Object.entries(e).map((e=>{let[n,r]=e;const o=gt(r,t,{$$lazyForUseBrick:!0,$$stateOfUseBrick:"useBrick"===n?ft.USE_BRICK:ft.INITIAL});if("style"!==n&&"dataset"!==n||(0,u.isObject)(o))return[n,o]})).filter(Boolean)):{}}(t,n);Array.isArray(e)||(e=[e]),e.forEach((e=>{Ct(e,r)}))}function Ot(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Tt(e){return e&&e.sensitive?"":"i"}function _t(e,t,n){return function(e,t,n){void 0===n&&(n={});for(var r=n.strict,o=void 0!==r&&r,a=n.start,i=void 0===a||a,s=n.end,c=void 0===s||s,l=n.encode,u=void 0===l?function(e){return e}:l,d=n.delimiter,f=void 0===d?"/#?":d,p=n.endsWith,h="[".concat(Ot(void 0===p?"":p),"]|$"),m="[".concat(Ot(f),"]"),g=i?"^":"",v=0,b=e;v<b.length;v++){var y=b[v];if("string"==typeof y)g+=Ot(u(y));else{var w=Ot(u(y.prefix)),E=Ot(u(y.suffix));if(y.pattern)if(t&&t.push(y),w||E)if("+"===y.modifier||"*"===y.modifier){var S="*"===y.modifier?"?":"";g+="(?:".concat(w,"((?:").concat(y.pattern,")(?:").concat(E).concat(w,"(?:").concat(y.pattern,"))*)").concat(E,")").concat(S)}else g+="(?:".concat(w,"(").concat(y.pattern,")").concat(E,")").concat(y.modifier);else"+"===y.modifier||"*"===y.modifier?g+="((?:".concat(y.pattern,")").concat(y.modifier,")"):g+="(".concat(y.pattern,")").concat(y.modifier);else g+="(?:".concat(w).concat(E,")").concat(y.modifier)}}if(c)o||(g+="".concat(m,"?")),g+=n.endsWith?"(?=".concat(h,")"):"$";else{var A=e[e.length-1],k="string"==typeof A?m.indexOf(A[A.length-1])>-1:void 0===A;o||(g+="(?:".concat(m,"(?=").concat(h,"))?")),k||(g+="(?=".concat(m,"|").concat(h,")"))}return new RegExp(g,Tt(n))}(function(e,t){void 0===t&&(t={});for(var n=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var o=1,a="";if("?"===e[s=n+1])throw new TypeError('Pattern cannot start with "?" at '.concat(s));for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0==--o){s++;break}}else if("("===e[s]&&(o++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at ".concat(s));a+=e[s++]}else a+=e[s++]+e[s++];if(o)throw new TypeError("Unbalanced pattern at ".concat(n));if(!a)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:a}),n=s}else{for(var i="",s=n+1;s<e.length;){var c=e.charCodeAt(s);if(!(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||95===c))break;i+=e[s++]}if(!i)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:i}),n=s}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),r=t.prefixes,o=void 0===r?"./":r,a="[^".concat(Ot(t.delimiter||"/#?"),"]+?"),i=[],s=0,c=0,l="",u=function(e){if(c<n.length&&n[c].type===e)return n[c++].value},d=function(e){var t=u(e);if(void 0!==t)return t;var r=n[c],o=r.type,a=r.index;throw new TypeError("Unexpected ".concat(o," at ").concat(a,", expected ").concat(e))},f=function(){for(var e,t="";e=u("CHAR")||u("ESCAPED_CHAR");)t+=e;return t};c<n.length;){var p=u("CHAR"),h=u("NAME"),m=u("PATTERN");if(h||m){var g=p||"";-1===o.indexOf(g)&&(l+=g,g=""),l&&(i.push(l),l=""),i.push({name:h||s++,prefix:g,suffix:"",pattern:m||a,modifier:u("MODIFIER")||""})}else{var v=p||u("ESCAPED_CHAR");if(v)l+=v;else if(l&&(i.push(l),l=""),u("OPEN")){g=f();var b=u("NAME")||"",y=u("PATTERN")||"",w=f();d("CLOSE"),i.push({name:b||(y?s++:""),pattern:b&&!y?a:y,prefix:g,suffix:w,modifier:u("MODIFIER")||""})}else d("END")}}return i}(e,n),t,n)}function Pt(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,o=n.exec(e.source);o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){var r=e.map((function(e){return Pt(e,t,n).source}));return new RegExp("(?:".concat(r.join("|"),")"),Tt(n))}(e,t,n):_t(e,t,n)}const xt=new Map,Mt=1e4;let Lt=0;function $t(e,t){const{path:n,exact:r=!1,strict:o=!1,sensitive:a=!0}=t;return(Array.isArray(n)?n:[n]).reduce(((t,n)=>{if(t)return t;const{regexp:i,keys:s}=function(e,t){const n=`${t.end}${t.strict}${t.sensitive}`;let r=xt.get(n);r||xt.set(n,r=new Map);const o=r.get(e);if(o)return o;const a=[],i={regexp:Pt(e,a,t),keys:a};return Lt<Mt&&(r.set(e,i),Lt++),i}(n,{end:r,strict:o,sensitive:a}),c=i.exec(e);if(!c)return null;const[l,...u]=c,d=e===l;return r&&!d?null:{path:n,url:"/"===n&&""===l?"/":l,isExact:d,params:s.reduce(((e,t,n)=>(e[t.name]=u[n],e)),{})}}),null)}function Bt(e,t,n){return $t(n,{path:e.path.replace(/^\$\{APP.homepage\}/,t),exact:e.exact})}const Nt=Symbol.for("tpl.asyncComputedPropsFromHost"),Ut=Symbol.for("tpl.stateStoreId"),Ft=Symbol.for("tpl.externalForEachItem"),jt=Symbol.for("tpl.externalForEachIndex"),Dt=Symbol.for("tpl.externalForEachSize"),Kt=new Set;let Vt=function(e){return e.REQUEST_FAILED="REQUEST_FAILED",e.SOMETHING_WENT_WRONG="SOMETHING_WENT_WRONG",e.LOGIN_TIMEOUT_MESSAGE="LOGIN_TIMEOUT_MESSAGE",e.NETWORK_ERROR="NETWORK_ERROR",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.NO_PERMISSION="NO_PERMISSION",e.PAGE_NOT_FOUND="PAGE_NOT_FOUND",e.APP_NOT_FOUND="APP_NOT_FOUND",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.GO_BACK_TO_PREVIOUS_PAGE="GO_BACK_TO_PREVIOUS_PAGE",e.GO_BACK_HOME="GO_BACK_HOME",e}({});const Wt={[Vt.REQUEST_FAILED]:"Request Failed",[Vt.SOMETHING_WENT_WRONG]:"Something went wrong!",[Vt.LOGIN_TIMEOUT_MESSAGE]:"You haven't logged in or your login session has expired. Login right now?",[Vt.NETWORK_ERROR]:"Network error, please check your network.",[Vt.LICENSE_EXPIRED]:"The license authorization has expired, please contact the platform administrator",[Vt.NO_PERMISSION]:"Unauthorized access, unable to retrieve the required resources for this page",[Vt.PAGE_NOT_FOUND]:"Page not found, please check the URL",[Vt.APP_NOT_FOUND]:"App not found, maybe the URL is wrong or you don't have permission to access",[Vt.UNKNOWN_ERROR]:"Oops! Something went wrong",[Vt.GO_BACK_TO_PREVIOUS_PAGE]:"Go back to previous page",[Vt.GO_BACK_HOME]:"Go back to home page"},Ht={[Vt.REQUEST_FAILED]:"请求失败",[Vt.SOMETHING_WENT_WRONG]:"出现了一些问题！",[Vt.LOGIN_TIMEOUT_MESSAGE]:"您还未登录或登录信息已过期，现在重新登录？",[Vt.NETWORK_ERROR]:"网络错误，请检查您的网络连接。",[Vt.LICENSE_EXPIRED]:"License 授权失效，请联系平台管理员",[Vt.NO_PERMISSION]:"没有权限，无法获取页面所需要的资源",[Vt.PAGE_NOT_FOUND]:"请求的页面未找到，请确认 URL 是否正确",[Vt.APP_NOT_FOUND]:"请求的微应用无法找到, 可能是 URL 错误或者无权限访问",[Vt.UNKNOWN_ERROR]:"糟糕！页面出现了一些问题",[Vt.GO_BACK_TO_PREVIOUS_PAGE]:"回到上一页",[Vt.GO_BACK_HOME]:"回到首页"},zt="core/runtime",Gt={en:Wt,zh:Ht};let qt;const Yt=Object.freeze({show:function(e){if(qt)return qt.resolve(e);if("confirm"===e.type){const t=confirm(e.content);return new Promise(((e,n)=>setTimeout((()=>{(t?e:n)()}),1)))}return alert(e.content),new Promise((e=>setTimeout((()=>{e()}),1)))}});function Xt(e){const{search:t,pathname:n}=e,r=n?window.btoa(encodeURIComponent(n)):"",o=t?window.btoa(encodeURIComponent(t)):"";document.cookie=`SALOGINPATH=${r}; path=/`,document.cookie=`SALOGINQUERY=${o}; path=/`}function Jt(e){if(e instanceof Event&&e.target instanceof HTMLScriptElement)return e.target.src;if(e instanceof R.HttpFetchError)return c.i18n.t(`${zt}:${Vt.NETWORK_ERROR}`);if(e instanceof R.HttpResponseError&&e.responseJson){if("string"==typeof e.responseJson.error)return e.responseJson.error;if("string"==typeof e.responseJson.msg)return e.responseJson.msg}return null==e?"Unknown error":e.toString()}function Qt(e){return e instanceof R.HttpResponseError&&401===e.response.status&&!!e.responseJson&&100003===e.responseJson.code}let Zt,en,tn=!1;function nn(e){if(e instanceof R.HttpAbortError)return;if(Qt(e)&&!window.NO_AUTH_GUARD){if(tn)return;return tn=!0,void Yt.show({type:"confirm",content:c.i18n.t(`${zt}:${Vt.LOGIN_TIMEOUT_MESSAGE}`)}).then((()=>{!function(){const e=ya().getFeatureFlags()["sso-enabled"],t=k();Xt(t.location),t.push(e?"/sso-auth/login":"/auth/login",{from:{...t.location,state:void 0}})}(),tn=!1}),(()=>{tn=!1}))}console.error(e);const t=Jt(e);t!==Zt&&(Zt=t,Yt.show({type:"error",title:c.i18n.t(`${zt}:${Vt.REQUEST_FAILED}`),content:t,contentStyle:{whiteSpace:"pre-wrap",wordBreak:"break-word"}}).then((()=>{Zt=void 0})))}const rn=Object.freeze({show:function(e){en?en.resolve(e):alert(e.message)}});function on(e,t,n){t&&Object.entries(t).forEach((t=>{let[r,o]=t;const a=un(o,n,{element:e});e.addEventListener(r,a),e.$$listeners||(e.$$listeners=[]),e.$$listeners.push([r,a]),e.$$eventListeners||(e.$$eventListeners=[]);for(const t of[].concat(o))e.$$eventListeners.push([r,null,t])}))}function an(e){return"string"==typeof e.action}function sn(e){return"string"==typeof e.useProvider}function cn(e){return!(!e.target&&!e.targetRef||!e.method&&!e.properties)}function ln(e){return!!e.then}function un(e,t,n){return function(r){for(const o of[].concat(e))if(wt(o,{...t,event:r}))if(ln(o))un(o.then,t,n)(r);else if(an(o)){const[e,a]=o.action.split(".");switch(o.action){case"history.push":case"history.replace":case"history.pushQuery":case"history.replaceQuery":case"history.pushAnchor":case"history.block":case"history.goBack":case"history.goForward":case"history.reload":case"history.unblock":hn(r,a,o.args,o.callback,t);break;case"window.open":mn(r,o.args,t);break;case"window.postMessage":gn(r,o.args,t);break;case"location.reload":case"location.assign":En(r,a,o.args,t);break;case"localStorage.setItem":case"localStorage.removeItem":case"sessionStorage.setItem":case"sessionStorage.removeItem":Sn(r,e,a,o.args,t);break;case"event.preventDefault":r.preventDefault();break;case"event.stopPropagation":r.stopPropagation();break;case"console.log":case"console.error":case"console.warn":case"console.info":An(r,a,o.args,t);break;case"message.success":case"message.error":case"message.info":case"message.warn":kn(r,a,o.args,t);break;case"handleHttpError":nn(r.detail);break;case"context.assign":case"context.replace":case"context.refresh":case"context.load":bn(r,a,o.args,o.batch??!0,o.callback,t);break;case"state.update":case"state.refresh":case"state.load":yn(r,a,o.args,o.batch??!0,o.callback,t);break;case"tpl.dispatchEvent":{const[e,n]=Rn(o.args,t,r);Me(t,o.action,`: ${e}`).dispatchEvent(new CustomEvent(e,n));break}case"formstate.update":wn(r,o.args,o.callback,t);break;case"message.subscribe":case"message.unsubscribe":In(r,a,o.args,t,n,o.callback);break;case"theme.setDarkTheme":case"theme.setLightTheme":te("theme.setDarkTheme"===o.action?"dark":"light");break;case"theme.setTheme":{const[e]=Rn(o.args,t,r);te(e);break}case"mode.setDashboardMode":case"mode.setDefaultMode":se("mode.setDashboardMode"===o.action?"dashboard":"default");break;default:console.error("unknown event listener action:",o.action)}}else sn(o)?dn(r,o,t,n):cn(o)?fn(r,o,t,n):console.error("unknown event handler:",o);else o.else&&un(o.else,t,n)(r)}}function dn(e,t,n,r){const o="saveAs"!==t.method?"resolve":"saveAs";pn(e,t.useProvider,t,o,n,r)}function fn(e,t,n,r){let o=[];const a=t.target,i=t.targetRef;let s=a;if(("string"==typeof a?(0,O.isEvaluable)(a):at(a))&&(s=gt(a,{...n,event:e})),"string"==typeof s)if("_self"===s)o.push(r.element);else if(t.multiple)o=Array.from(document.querySelectorAll(s));else{const e=document.querySelector(s);null!==e&&o.push(e)}else if(s)s instanceof HTMLElement?o.push(s):console.error("unexpected target:",s);else if(i){let t=i;("string"==typeof i?(0,O.isEvaluable)(i):at(i))&&(t=gt(i,{...n,event:e}));const r=[].concat(t),a=Me(n,"targetRef",`: ${r.join(", ")}`);o.push(...r.map((e=>{var t;return null===(t=a.$$getElementByRef)||void 0===t?void 0:t.call(a,e)})).filter(Boolean))}0!==o.length?function(e){return!!e.method}(t)?o.forEach((o=>{pn(e,o,t,t.method,n,r,{useEventAsDefault:!0})})):function(e){return!!e.properties}(t)&&Rt(o,t.properties,{...n,event:e}):console.error("target not found:",a||i)}async function pn(e,t,n,r,o,a,i){const s=sn(n),c=async()=>{var a;const c=s?await Xe(t):t;if("function"!=typeof c[r])throw new Error(`target <${c.tagName.toLowerCase()}> has no method: ${r}`);let l=Rn(n.args,o,e,i);var u;return sn(n)&&null!=va&&null!==(a=va.flowApi)&&void 0!==a&&a.isFlowApiProvider(n.useProvider)&&(l=await va.flowApi.getArgsOfFlowApi(n.useProvider,l,r,null===(u=n.sse)||void 0===u?void 0:u.stream)),c[r](...l)};if(!n.callback)return void c();const l=Cn(n.callback,o,a),u={progress:l("progress"),success:l("success"),error:l("error"),finally:l("finally")};if(s){var d,f;const t={...o,event:e};if(gt(null===(d=n.sse)||void 0===d?void 0:d.stream,t))return void async function(e,t){let{progress:n,success:r,error:o,finally:a}=t;const i=Ia();try{const t=await e();for await(const e of t){if(i!==Ia())return;null==n||n(e)}if(i!==Ia())return;null==r||r()}catch(e){if(i!==Ia())return;null==o||o(e)}finally{null==a||a()}}(c,u);if(gt(null===(f=n.poll)||void 0===f?void 0:f.enabled,t))return void function(e,t,n,r){let{progress:o,success:a,error:i,finally:s}=t;const{expectPollStopImmediately:c,expectPollEnd:l}=n,{interval:u,leadingRequestDelay:d,continueOnError:f,delegateLoadingBar:p}=gt((0,h.pick)(n,["interval","leadingRequestDelay","continueOnError","delegateLoadingBar"]),r),m=Ia();let g;async function v(){let t;Kt.delete(g);try{var n;if(t=null===(n=gt(c,r))||void 0===n?void 0:n(),t)null==s||s();else{var d;const n=await e(),i=null===(d=gt(c,r))||void 0===d?void 0:d();var h;t=i||m!==Ia(),t?i&&(null==s||s()):(null==o||o(n),null!==(h=gt(l,r))&&void 0!==h&&h(n)?(p&&window.dispatchEvent(new Event("request.end")),null==a||a(n),null==s||s()):b(u??3e3))}}catch(e){var v;const n=null===(v=gt(c,r))||void 0===v?void 0:v();t=n||m!==Ia(),t?n&&(null==s||s()):(null==i||i(e),f?b(u??3e3):null==s||s())}finally{p&&t&&window.dispatchEvent(new Event("request.end"))}}function b(e){g=setTimeout(v,e),Kt.add(g)}b(d??0),p&&window.dispatchEvent(new Event("request.start"))}(c,u,n.poll,t)}try{const e=await c();u.success(e)}catch(e){u.error(e)}finally{u.finally()}}function hn(e,t,n,r,o){let a=0,i=!1,s=t;switch(t){case"push":case"replace":case"pushQuery":case"replaceQuery":case"pushAnchor":a=2,i=!0;break;case"reload":i=!0;break;case"block":a=1,s="setBlockMessage"}let c=[];if(a>0&&(c=Rn(n,o,e,{useEventDetailAsDefault:!0}),c.length=a),i&&r){const e=Cn(r,o,void 0);c.push((t=>{e(t?"error":"success")({blocked:t}),e("finally")({blocked:t})}))}k()[s](...c)}function mn(e,t,n){const[r,o,a]=Rn(t,n,e);window.open(r,o||"_self",a)}function gn(e,t,n){const r=Rn(t,n,e);1===r.length&&r.push(location.origin),window.postMessage(...r)}function vn(e,t,n,r,o,a){t?r.updateValues(e,n,(e=>Rn(e,o,a)[0])):e.forEach((e=>{const{name:t,value:i}=Rn([e],o,a)[0];r.updateValue(t,i,n)}))}function bn(e,t,n,r,o,a){if(!Array.isArray(n)||!n.every(u.isObject)||"assign"!==t&&"replace"!==t){const[r,i]=Rn(n,a,e);a.ctxStore.updateValue(r,i,t,o,a)}else vn(n,r,t,a.ctxStore,a,e)}function yn(e,t,n,r,o,a){if(Array.isArray(n)&&n.every(u.isObject)&&"update"===t)vn(n,r,"replace",xe(a,`state.${t}`,`: ${JSON.stringify(n)}`),a,e);else{const[r,i]=Rn(n,a,e);xe(a,`state.${t}`,`: ${r}`).updateValue(r,i,"update"===t?"replace":t,o,a)}}function wn(e,t,n,r){const[o,a]=Rn(t,r,e);qe(r,"formstate.update",`: ${o}`).updateValue(o,a,"replace",n,r)}function En(e,t,n,r){if("assign"===t){const[t]=Rn(n,r,e);location.assign(t)}else location[t]()}function Sn(e,t,n,r,o){const a="localStorage"===t?localStorage:sessionStorage,[i,s]=Rn(r,o,e);"setItem"===n?void 0!==s&&a.setItem(i,JSON.stringify(s)):a.removeItem(i)}function An(e,t,n,r){console[t](...Rn(n,r,e,{useEventAsDefault:!0}))}function kn(e,t,n,r){const o=Rn(n,r,e,{useEventAsDefault:!0});rn.show({type:t,message:o[0]})}async function In(e,t,n,r,o,a){const i=()=>{var o;const a=Rn(n,r,e);return null==va||null===(o=va.messageDispatcher)||void 0===o?void 0:o[t](...a)};if(!a)return void i();const s=Cn(a,r,o);try{const e=await i();s("success")(e)}catch(e){s("error")(e)}finally{s("finally")()}}function Cn(e,t,n){return function(r){return function(o){const a=null==e?void 0:e[r];if(a)try{const e=new CustomEvent(`callback.${r}`,{detail:o});un(a,t,n)(e)}catch(e){console.error(e)}else"error"===r&&console.error("Unhandled callback error:",o)}}}function Rn(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Array.isArray(e)?gt(e,{...t,event:n}):r.useEventAsDefault?[n]:r.useEventDetailAsDefault?[n.detail]:[]}function On(e){var t;const{ref:n,runtimeContext:r,element:o}=e;if(!n||!r.tplStateStoreId)return;const{hostBrick:a}=xe(r,"bindTemplateProxy"),i=a.tplHostMetadata;i.internalBricksByRef.set(n,e);const s=null===(t=i.proxy)||void 0===t?void 0:t.events;if(s)for(const[e,t]of Object.entries(s))if(t.ref===n){var c;const n=t=>{t.bubbles&&t.stopPropagation(),a.element.dispatchEvent(new CustomEvent(e,{detail:t.detail,bubbles:t.bubbles,cancelable:t.cancelable,composed:t.composed}))},r=t.refEvent??e;o.addEventListener(r,n),(c=o).$$proxyListeners??(c.$$proxyListeners=[]),o.$$proxyListeners.push([r,n])}}function Tn(e){const{ref:t,runtimeContext:n,element:r}=e;if(null==n||!n.tplStateStoreId||!t)return;const{hostBrick:o}=xe(n,"unbindTemplateProxy");o.tplHostMetadata.internalBricksByRef.delete(t);for(const[e,t]of r.$$proxyListeners??[])r.removeEventListener(e,t);delete r.$$proxyListeners}let _n=function(e){return e[e.ROOT=1]="ROOT",e[e.BRICK=2]="BRICK",e[e.PLACEHOLDER=3]="PLACEHOLDER",e}({});function Pn(e){e.replaceChildren()}function xn(e,t){window.DISABLE_REACT_FLUSH_SYNC=!1;let n=e.child;const r=[];for(;n;){if(n.tag===_n.BRICK){var o;const a=n.type;a.includes("-")&&!customElements.get(a)&&console.error(`Undefined custom element: ${a}`),"basic-bricks.script-brick"===a&&console.warn("`basic-bricks.script-brick` is deprecated, please take caution when using it");const i=t&&n===e.child?t:document.createElement(a);n.element=i,n.slotId&&i.setAttribute("slot",n.slotId),n.iid&&(i.dataset.iid=n.iid),null!==(o=n.tplHostMetadata)&&void 0!==o&&o.tplStateStoreId&&(i.dataset.tplStateStoreId=n.tplHostMetadata.tplStateStoreId),Ct(i,n.properties),on(i,n.events,n.runtimeContext),n.tplHostMetadata&&(i.$$tplStateStore=xe({tplStateStoreId:n.tplHostMetadata.tplStateStoreId,tplStateStoreMap:n.runtimeContext.tplStateStoreMap},"mount")),On(n),n.portal?r.push(i):n.return&&(n.return.childElements||(n.return.childElements=[]),n.return.childElements.push(i))}if(n.child)n=n.child;else if(n.sibling)n=n.sibling;else{var a;let e=n.return;for(;e;){var i;if(e.childElements)e.tag===_n.ROOT?null===(i=e.container)||void 0===i||i.append(...e.childElements):e.element.append(...e.childElements),e.childElements=void 0;if(e.tag===_n.ROOT&&r.length>0&&("function"==typeof e.createPortal?e.createPortal():e.createPortal).append(...r),e.sibling)break;e=e.return}n=null===(a=e)||void 0===a?void 0:a.sibling}}setTimeout((()=>{window.DISABLE_REACT_FLUSH_SYNC=!0}))}const Mn=["onMount","onUnmount","onMediaChange","onScrollIntoView","onMessage","onMessageClose"],Ln=["onBeforePageLoad","onPageLoad","onPageLeave","onBeforePageLeave","onAnchorLoad","onAnchorUnload"];var $n=new WeakMap,Bn=new WeakMap,Nn=new WeakMap,Un=new WeakMap,Fn=new WeakMap,jn=new WeakMap,Dn=new WeakMap,Kn=new WeakMap,Vn=new WeakMap,Wn=new WeakSet;class Hn{constructor(e,t){(0,I.A)(this,Wn),(0,o.A)(this,"scope",void 0),(0,o.A)(this,"unknownBricks",void 0),(0,o.A)(this,"renderId",void 0),(0,a.A)(this,$n,void 0),(0,a.A)(this,Bn,{onBeforePageLoad:[],onPageLoad:[],onPageLeave:[],onBeforePageLeave:[],onAnchorLoad:[],onAnchorUnload:[],onMediaChange:[],onScrollIntoView:[],onMount:[],onUnmount:[],onMessage:[],onMessageClose:[]}),(0,a.A)(this,Nn,new Map),(0,a.A)(this,Un,void 0),(0,a.A)(this,Fn,new Map),(0,a.A)(this,jn,void 0),(0,a.A)(this,Dn,void 0),(0,a.A)(this,Kn,new WeakMap),(0,a.A)(this,Vn,new Map),this.scope=e,this.unknownBricks=(null==t?void 0:t.unknownBricks)??"throw",(0,i.A)($n,this,null==t?void 0:t.routeHelper),this.renderId=null==t?void 0:t.renderId}setInitialMenuRequestNode(e){(0,i.A)(Dn,this,e)}memoizeMenuRequestNode(e,t){(0,s.A)(Kn,this).set(e,t)}getMenuRequests(){const e=[];let t=(0,s.A)(Dn,this);for(;t;)if(t.request&&e.push(t.request),t.child)t=t.child;else{for(var n;t&&!t.sibling;)t=t.return;t=null===(n=t)||void 0===n?void 0:n.sibling}return e}async reMergeMenuRequestNodes(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(0,s.A)(Kn,this).get(t);(0,s.A)(Kn,this).set(t,n);let o,a=e.child;for(;a&&a!==r;)o=a,a=a.sibling;o?(o.sibling=n,n.sibling=null==r?void 0:r.sibling):e.child=n,await(0,s.A)($n,this).mergeMenus(this.getMenuRequests())}reBailout(e){return(0,s.A)($n,this).bailout(e)}reCatch(e,t){return(0,s.A)($n,this).catch(e,t)}async didPerformIncrementalRender(e,t){let n=!1;const r=[];for(const{parentRoutes:o,callback:a}of[...(0,s.A)(Vn,this).values()].reverse()){const i=o[o.length-1];if(r.includes(i))continue;const s=await a(e,t);s&&r.push(...o.slice(0,-1)),!1!==s&&(n=!0)}return n}performIncrementalRender(e,t,n){(0,s.A)(Vn,this).set(e,{parentRoutes:t,callback:n})}registerBrickLifeCycle(e,t){if(!t)return;const n=[...Mn,..."page"===this.scope?Ln:[]];for(const r of n){const n=t[r];n&&(0,s.A)(Bn,this)[r].push({brick:e,handlers:n})}(0,h.isEmpty)(t.useResolves)||console.error("`lifeCycle.useResolves` is dropped in v3:",t)}registerArbitraryLifeCycle(e,t){const n=(0,s.A)(Fn,this).get(e);n?n.add(t):(0,s.A)(Fn,this).set(e,new Set([t]))}memoize(e,t,n,r){(0,s.A)(jn,this)||(0,i.A)(jn,this,new WeakMap);const o=[e??"",...t].join(".");let a=(0,s.A)(jn,this).get(r);a||(a=new Map,(0,s.A)(jn,this).set(r,a)),a.set(o,{node:n,last:Xn(n),lastNormal:Jn(n),lastPortal:Zn(n)})}reRender(e,t,n,r){const o=[e??"",...t].join("."),a=(0,s.A)(jn,this).get(r).get(o),{node:i,last:c,lastNormal:l,lastPortal:u}=a;let d;const f=[];if((null==i?void 0:i.tag)===_n.PLACEHOLDER){var p,h;d=(null===(p=function(e){return Qn(e,!0)}(i))||void 0===p?void 0:p.element)??null;const e=null===(h=function(e){return er(e,!0)}(i))||void 0===h?void 0:h.element;e&&f.push(e)}else{var m,g;d=(null==l||null===(m=l.element)||void 0===m?void 0:m.nextSibling)??null;let e=null==u||null===(g=u.element)||void 0===g?void 0:g.nextSibling;for(;e&&(f.push(e),e instanceof HTMLElement&&"DIV"===e.tagName);)e=e.nextSibling}const v=Xn(n);let b;a.node=n,a.last=v,a.lastNormal=Jn(n),a.lastPortal=Zn(n);let y=r.child;for(;y&&y!==c;){if(y.sibling===i){b=y;break}y=y.sibling}const w=document.createDocumentFragment(),E=document.createDocumentFragment(),S={tag:_n.ROOT,container:w,createPortal:E,child:n};for(y=n;y;)y.return=S,y=y.sibling;const A=tr(i,c);for((0,C.A)(Wn,this,zn).call(this,A),xn(S),b?b.sibling=n:r.child=n,v&&(v.sibling=null==c?void 0:c.sibling),y=n;y;)y.return=r,y=y.sibling;var k,I;if(r.tag===_n.ROOT?null===(k=r.container)||void 0===k||k.insertBefore(w,d):null===(I=r.element)||void 0===I||I.insertBefore(w,d),E.childNodes.length>0){var R;let e=n;for(;e&&e.return;)e=e.return;if((null===(R=e)||void 0===R?void 0:R.tag)!==_n.ROOT)throw new Error("Cannot find render root node. This is a bug of Brick Next, please report it.");const t="function"==typeof e.createPortal?e.createPortal():e.createPortal;let r=null;for(const e of f)if(t.contains(e)){r=e;break}t.insertBefore(E,r)}const O=tr(n,v);(0,C.A)(Wn,this,Gn).call(this,O)}dispose(){for(const e of Object.values((0,s.A)(Bn,this)))e.length=0;for(const e of(0,s.A)(Nn,this).values()){for(const t of e)t.disconnect();e.length=0}(0,s.A)(Nn,this).clear(),(0,s.A)(Un,this)&&(Ee.removeEventListener("change",(0,s.A)(Un,this)),(0,i.A)(Un,this,void 0)),(0,i.A)(jn,this,void 0),(0,s.A)(Fn,this).clear(),(0,s.A)(Vn,this).clear(),(0,i.A)(Kn,this,void 0)}dispatchBeforePageLoad(){(0,C.A)(Wn,this,qn).call(this,"onBeforePageLoad",new CustomEvent("page.beforeLoad"))}dispatchPageLoad(){const e=new CustomEvent("page.load");(0,C.A)(Wn,this,qn).call(this,"onPageLoad",e),window.dispatchEvent(e)}dispatchBeforePageLeave(e){(0,C.A)(Wn,this,qn).call(this,"onBeforePageLeave",new CustomEvent("page.beforeLeave",{detail:e}))}dispatchPageLeave(){(0,C.A)(Wn,this,qn).call(this,"onPageLeave",new CustomEvent("page.leave"))}dispatchAnchorLoad(){const{hash:e}=k().location;e&&"#"!==e?(0,C.A)(Wn,this,qn).call(this,"onAnchorLoad",new CustomEvent("anchor.load",{detail:{hash:e,anchor:e.substring(1)}})):(0,C.A)(Wn,this,qn).call(this,"onAnchorUnload",new CustomEvent("anchor.unload"))}initializeScrollIntoView(){for(const{brick:e,handlers:t}of(0,s.A)(Bn,this).onScrollIntoView)(0,C.A)(Wn,this,Yn).call(this,e,t)}initializeMediaChange(){(0,i.A)(Un,this,(e=>{(0,C.A)(Wn,this,qn).call(this,"onMediaChange",new CustomEvent("media.change",{detail:G(e.detail)}))})),Ee.addEventListener("change",(0,s.A)(Un,this))}initializeMessageDispatcher(){var e;for(const{brick:e,handlers:n}of(0,s.A)(Bn,this).onMessage)for(const r of[].concat(n)){var t;null==va||null===(t=va.messageDispatcher)||void 0===t||t.onMessage(r.channel,(t=>{un(r.handlers,e.runtimeContext,e)(new CustomEvent("message.push",{detail:t}))}))}null==va||null===(e=va.messageDispatcher)||void 0===e||e.onClose((()=>{(0,C.A)(Wn,this,qn).call(this,"onMessageClose",new CustomEvent("message.close"))}))}dispatchOnMount(){(0,C.A)(Wn,this,qn).call(this,"onMount",new CustomEvent("mount"))}dispatchOnUnmount(){(0,C.A)(Wn,this,qn).call(this,"onUnmount",new CustomEvent("unmount"))}}function zn(e){const t=[...Mn,..."page"===this.scope?Ln:[]],n=[];for(const r of t){const t=(0,h.remove)((0,s.A)(Bn,this)[r],(t=>e.has(t.brick)));"onUnmount"===r&&n.push(...t)}for(const t of e){var r,o;const e=(0,s.A)(Nn,this).get(t);if(null!=e&&e.length){for(const t of e)t.disconnect();e.length=0,(0,s.A)(Nn,this).delete(t)}Tn(t),null===(r=t.element)||void 0===r||delete r.$$tplStateStore,null===(o=t.element)||void 0===o||o.remove()}const a=new CustomEvent("unmount");for(const{brick:e,handlers:t}of n)un(t,e.runtimeContext,e)(a)}function Gn(e){const t=new CustomEvent("mount");for(const{brick:n,handlers:r}of(0,s.A)(Bn,this).onMount)e.has(n)&&un(r,n.runtimeContext,n)(t);for(const{brick:t,handlers:n}of(0,s.A)(Bn,this).onScrollIntoView)e.has(t)&&(0,C.A)(Wn,this,Yn).call(this,t,n)}function qn(e,t){for(const{brick:n,handlers:r}of(0,s.A)(Bn,this)[e])un(r,n.runtimeContext,n)(t);const n=(0,s.A)(Fn,this).get(e);if(n)for(const e of n)e()}function Yn(e,t){const n=t.threshold??.1,r=new IntersectionObserver(((r,o)=>{r.forEach((r=>{r.isIntersecting&&r.intersectionRatio>=n&&(un(t.handlers,e.runtimeContext,e)(new CustomEvent("scroll.into.view")),o.disconnect())}))}),{threshold:n});r.observe(e.element);let o=(0,s.A)(Nn,this).get(e);o||(o=[],(0,s.A)(Nn,this).set(e,o)),o.push(r)}function Xn(e){let t=e;for(;null!==(n=t)&&void 0!==n&&n.sibling;){var n;t=t.sibling}return t}function Jn(e){return Qn(e,!1)}function Qn(e,t){let n,r=e;for(;r;){if(r.tag===_n.BRICK&&!r.portal){if(t)return r;n=r}r=r.sibling}return n}function Zn(e){return er(e,!1)}function er(e,t){let n,r=e;for(;r;){if(r.tag===_n.BRICK&&r.portal){if(t)return r;n=r}if(r.child)r=r.child;else if(r.sibling)r=r.sibling;else{var o;let e=r.return;for(;e&&!e.sibling;)e=e.return;r=null===(o=e)||void 0===o?void 0:o.sibling}}return n}function tr(e,t){const n=new Set;let r=e;for(;r;)if(r.tag===_n.BRICK&&n.add(r),r.child)r=r.child;else{if(r===t)break;if(r.sibling)r=r.sibling;else{var o;let e=r.return;for(;e&&e!==t&&!e.sibling;)e=e.return;if(e===t)break;r=null===(o=e)||void 0===o?void 0:o.sibling}}return n}const nr=new Map;function rr(e){return nr.get(e)}const or=Symbol.for("root.runtimeContext");async function ar(e,t,n){var r,o;const[a,i,s]=eo({...e[or]??Ca(),data:t,pendingPermissionsPreCheck:[]});a.tplStateStoreMap??(a.tplStateStoreMap=new Map),a.formStateStoreMap??(a.formStateStoreMap=new Map);const c=new Hn("fragment"),l={tag:_n.ROOT,createPortal:null},u=e.transform,d=Re();u&&Oe(d,"`useBrick.transform`",'please use "properties" instead, check your useBrick:',e);const f=await Jr(l,d&&!n?e:{errorBoundary:n,...e,properties:{...e.properties,...u}},a,c,[],{}),p=[...i,...s];if(await Zr(f,a,p),(null===(r=f.node)||void 0===r?void 0:r.tag)===_n.PLACEHOLDER)throw new Error("The root brick of useBrick cannot be an ignored control node");if(null!==(o=f.node)&&void 0!==o&&o.portal)throw new Error("The root brick of useBrick cannot be a portal brick");return l.child=f.node,{tagName:f.node?f.node.type:null,renderRoot:l,rendererContext:c,scopedStores:p}}function ir(e,t){let n,{renderRoot:r,rendererContext:o,scopedStores:a}=e;r.createPortal=()=>{const e=document.querySelector("#portal-mount-point");return n=document.createElement("div"),e.appendChild(n),n},xn(r,t),o.dispatchOnMount(),o.initializeScrollIntoView(),o.initializeMediaChange(),o.initializeMessageDispatcher();for(const e of a)e.mountAsyncData();return{portal:n}}function sr(e,t){let{rendererContext:n}=e;t.portal&&(Pn(t.portal),t.portal.remove()),n.dispatchOnUnmount(),n.dispose()}function cr(e,t,n){if(n)throw new Error("Legacy doTransform does not support options in v3");return gt(t,{...Ca(),data:e},{noInject:!0})}function lr(e,t){const n=Ra(e);Object.assign(n,{...t,meta:{...n.meta,...t.meta},$$fulfilling:null,$$fulfilled:!0,$$registerCustomTemplateProcessed:!1}),L(n)}function ur(e,t){const n=Ra(e);let r=!1;function o(e){e.forEach(((n,i)=>{"routes"===n.type?o(n.routes):function(e){return e.path===t.path&&!e.exact==!t.exact}(n)?(r=!0,e[i]=t):Array.isArray(n.bricks)&&a(n.bricks)}))}function a(e){e.forEach((e=>{if(e.slots)for(const t of Object.values(e.slots))"routes"===t.type?o(t.routes):a(t.bricks)}))}o(n.routes),r||n.routes.unshift(t)}function dr(e,t,n){const r=`${e}.${t.name}`;Pe.define(r,{bricks:t.bricks,proxy:t.proxy,state:t.state}),fr(e,t.name,n)}function fr(e,t,n){gr(e,`\${APP.homepage}/_dev_only_/template-preview/${t}`,[{brick:t,...(0,h.pick)(n,"properties","events","lifeCycle","context","slots","children")}])}function pr(e){return`\${APP.homepage}/_dev_only_/snippet-preview/${e}`}function hr(e,t){var n;gr(e,pr(t.snippetId),null!==(n=t.bricks)&&void 0!==n&&n.length?t.bricks:[{brick:"span"}],t.context)}const mr=hr;function gr(e,t,n,r){const{routes:o}=Ra(e),a=o.findIndex((e=>e.path===t)),i={path:t,bricks:n,context:r,menu:!1,exact:!0};-1===a?o.unshift(i):o.splice(a,1,i)}function vr(e,t){let{tplStateStoreId:n}=t;const r=Ca();return n?xe({...r,tplStateStoreId:n},"STATE").getValue(e):r.ctxStore.getValue(e)}function br(e){let{tplStateStoreId:t}=e;const n=Ca();return t?xe({...n,tplStateStoreId:t},"STATE").getAllValues():n.ctxStore.getAllValues()}function yr(e){return Aa().find((t=>t.id?t.id===e:t.filePath.startsWith(`${e}/`)))}function wr(e){return(0,l.loadBricksImperatively)(e,Aa())}function Er(e,t){return(0,l.loadEditorsImperatively)(e,t??Aa())}function Sr(){return Ia()}async function Ar(e,t){let{appId:n,updateStoryboardType:r,collectUsedContracts:o}=t;const a=Ra(n);let i;if("route"===r)i={routes:[e]};else if("template"===r)i={meta:{customTemplates:[e]}};else if("snippet"===r){var s;const t=pr(e.snippetId);i={routes:[null==a||null===(s=a.routes)||void 0===s?void 0:s.find((e=>e.path===t))]}}const c=[];return i&&o&&(await o(i)).forEach((e=>{var t;const[n,r,o]=e.match(/(.*)@(.*):\d\.\d\.\d/);null!=a&&null!==(t=a.meta)&&void 0!==t&&null!==(t=t.contracts)&&void 0!==t&&t.some((e=>e.namespaceId===r&&e.name===o))||c.push(e)})),c}async function kr(e,t){let{tplStateStoreId:n,routeId:r}=t;const o={...Ca(),tplStateStoreId:n,match:rr(r)};return e.resolve?tt(e.resolve,o,{cache:"reload"}):mt(e.value,o)}function Ir(e){const t=Ca();return{app:(null==t?void 0:t.overrideApp)??(null==t?void 0:t.app),location:(0,h.pick)(location,["href","origin","hostname","host"]),...(0,h.pick)(t,["query","sys"]),match:rr(null==e?void 0:e.routeId)}}let Cr;const Rr=[];function Or(e){Cr=e;const t=br({tplStateStoreId:e.tplStateStoreId});_r({changeType:"initialize",tplStateStoreId:e.tplStateStoreId,detail:{data:t}})}function Tr(e){Rr.push(e)}function _r(e){setTimeout((()=>{for(const t of Rr)try{t(e)}catch(t){console.error(`RealTimeDataInspectHook failed (${e.changeType}):`,t)}}))}const Pr=["onBeforePageLoad","onPageLoad","onBeforePageLeave","onPageLeave","onAnchorLoad","onAnchorUnload"];class xr{constructor(e,t,n,r){(0,o.A)(this,"type",void 0),(0,o.A)(this,"data",new Map),(0,o.A)(this,"changeEventType",void 0),(0,o.A)(this,"pendingStack",[]),(0,o.A)(this,"hostBrick",void 0),(0,o.A)(this,"stateStoreId",void 0),(0,o.A)(this,"batchUpdate",!1),(0,o.A)(this,"batchUpdateContextsNames",[]),(0,o.A)(this,"rendererContext",void 0),(0,o.A)(this,"routeMap",new WeakMap),this.type=e,this.changeEventType="FORM_STATE"===this.type?"formstate.change":"STATE"===this.type?"state.change":"context.change",this.hostBrick=t,this.rendererContext=n,this.stateStoreId=r}getAllValues(){return Object.fromEntries([...this.data.entries()].map((e=>{let[t,{value:n}]=e;return[t,n]})))}getValue(e){var t;return null===(t=this.data.get(e))||void 0===t?void 0:t.value}notifyRealTimeDataChange(e,t){if(Cr){const{tplStateStoreId:n}=Cr;(n?"STATE"===this.type&&this.stateStoreId===n:"CTX"===this.type)&&_r({changeType:"update",tplStateStoreId:n,detail:{name:e,value:t}})}}getAffectListByContext(e){const t=[e];return this.data.forEach(((e,n)=>{e.deps&&e.deps.some((e=>t.includes(e)))&&t.push(n)&&t.push(...this.getAffectListByContext(n))})),t.shift(),[...new Set(t)]}updateValues(e,t,n){if(this.batchUpdate=!0,this.batchUpdateContextsNames=e.map((e=>e.name)),[...new Set(this.batchUpdateContextsNames)].length!==this.batchUpdateContextsNames.length)throw new Error("Batch update not allow to update same item");const r={},o={},a=[];e.forEach((e=>{const{name:o,value:i}=n([e]),s=this.data.get(o);a.push(...this.getAffectListByContext(o)),s&&(r[o]=s),this.updateValue(o,i,t)})),a.filter((e=>!r[e])).forEach((e=>{const t=this.data.get(e);t&&(o[e]=t)}));const i=e=>{for(const n in e){var t;const r=e[n];null===(t=r.eventTarget)||void 0===t||t.dispatchEvent(new CustomEvent(this.changeEventType,{detail:r.value}))}};i(r),i(o),this.batchUpdate=!1}updateValue(e,t,n,r,o){const a=this.data.get(e);if(!a)throw new Error(`${this.type} '${e}' is not defined`);if("refresh"!==n&&"load"!==n)"replace"===n?a.value=t:(0,u.isObject)(a.value)?Object.assign(a.value,t):(console.warn(`Non-object current value of "${this.type}.${e}" for "context.assign", try "context.replace" instead.`),a.value=t),this.batchUpdate||a.eventTarget.dispatchEvent(new CustomEvent(this.changeEventType,{detail:a.value}));else{if(!a.useResolve)throw new Error(`You can not ${n} "${this.type}.${e}" which is not using resolve`);let i;"load"===n&&(a.loaded?i=Promise.resolve(a.value):a.loading&&(i=a.loading));const s=e=>{var t;let n;return"FlowApiNotFoundError"===(null==e?void 0:e.name)&&!!(n=null===(t=this.rendererContext)||void 0===t?void 0:t.renderId)&&n!==Ia()};if(i||(i=a.loading=a.load({cache:"load"===n?"default":"reload",...t}),i.then((e=>{this.finishLoad(a,e)}),(e=>{!a.useResolve||s(e)||null!=r&&r.error||nn(e)}))),r){const e=Cn(r,o);i.then((t=>{e("success")({value:t}),e("finally")()}),(t=>{!s(t)&&r.error&&e("error")(t),e("finally")()}))}}}finishLoad(e,t){e.useResolve&&(e.loaded=!0,e.value=t,e.eventTarget.dispatchEvent(new CustomEvent(this.changeEventType,{detail:t})))}define(e,t,n,r){if(Array.isArray(e)&&e.length>0){const o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"CTX";const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CTX",n=arguments.length>2?arguments[2]:void 0;const r=new Map;for(const o of e){const e=[o.if,o.value,o.resolve],a=(0,T.collectMemberUsage)(e,t);if(!n&&"STATE"===t){const t=(0,T.collectMemberUsage)(e,"TPL");for(const e of t.usedProperties)a.usedProperties.add(e);t.hasNonStaticUsage&&(a.hasNonStaticUsage=!0)}r.set(o,a)}return r}(e,n,arguments.length>3?arguments[3]:void 0),o=new Map;for(const e of Array.from(r.keys()).map((e=>e.name)))o.set(e,(o.get(e)??0)+1);const a=Array.from(r.values()).some((e=>e.hasNonStaticUsage)),i=new WeakSet,s=new Map,c=new Map([...new Set(e.map((e=>e.name)))].map((e=>[e,new Promise(((t,n)=>{s.set(e,{resolve:t,reject:n})}))]))),l=async e=>{i.add(e);const n=await t(e);r.delete(e);const a=o.get(e.name)??0;if(n){if(s.get(e.name).resolve(),o.delete(e.name),0===a)throw new Error(`Duplicated context defined: ${e.name}`)}else 1===a?(s.get(e.name).resolve(),o.delete(e.name)):o.set(e.name,a-1);await d()};let u=a;async function d(){const e=Array.from(r.entries()).filter(function(e,t){return(n,r)=>t?0===r:![...n[1].usedProperties].some((t=>e.has(t)))}(o,u)).map((e=>e[0])).filter((e=>!i.has(e)));await Promise.all(e.map(l))}return{pendingResult:d().then((async()=>{r.size>0&&(function(e,t){const n=new Map(e),r=new Set(Array.from(n.keys()).map((e=>e.name))),o=()=>{let e=!1;for(const[t,o]of n.entries())[...o.usedProperties].some((e=>r.has(e)))||(n.delete(t),r.delete(t.name),e=!0);e&&o()};if(o(),n.size>0)throw new ReferenceError(`Circular ${t} detected: ${Array.from(n.keys()).map((e=>e.name)).join(", ")}`)}(r,n),u=!0,await d());for(const e of s.values())e.resolve()})).catch((e=>{for(const t of s.values())t.reject(e);throw e})),pendingContexts:c}}(e,(e=>this.resolve(e,t,n,r)),this.type,Re(t));this.pendingStack.push(o)}}onChange(e,t){var n;null===(n=this.data.get(e))||void 0===n||n.eventTarget.addEventListener(this.changeEventType,t)}async waitFor(e){for(const{pendingContexts:t}of this.pendingStack)await Promise.all([...e].map((e=>t.get(e))))}async waitForAll(){for(const{pendingContexts:e}of this.pendingStack)for(const t of e.values())t.catch((()=>{}));for(const{pendingResult:e}of this.pendingStack)await e}mountAsyncData(e){this.data.forEach((t=>{var n;if(t.async&&(!e||null!==(n=this.routeMap.get(e))&&void 0!==n&&n.has(t.name))){if(t.asyncMounted)return void console.error(`Async data "${t.name}" already mounted. This is a bug of Brick Next, please report it.`);t.asyncMounted=!0,t.loading.then((e=>{this.finishLoad(t,e)}))}}))}async resolve(e,t,n,r){if(!await yt(e,t))return!1;let o,a,i,s,c,l;if(n&&("STATE"===this.type?e.expose:"FORM_STATE"===this.type)&&(o=await kt(n,e.name)),void 0===o){if(e.resolve){const n=(0,u.hasOwnProperty)(e,"value");c=e.track&&n&&(0,u.hasOwnProperty)(e.resolve,"if")&&(0,T.strictCollectMemberUsage)(e.resolve.if,this.type).size>0;const r={transform:"value",...e.resolve};if(s=await yt(e.resolve,t),(s||c)&&(a=async e=>{var n;return(await tt(r,t,{...e,renderId:null===(n=this.rendererContext)||void 0===n?void 0:n.renderId})).value}),s)l=e.resolve.async?"async":e.resolve.lazy?"lazy":"eager","eager"===l?o=await a():"async"===l&&(i=a());else if(!n)return!1}s&&"eager"===l||void 0===e.value||(o=await mt(e.value,t))}if(this.data.has(e.name))throw new Error(`${this.type} '${e.name}' has already been declared`);const d={name:e.name,value:o,eventTarget:new be,useResolve:s,load:a,loaded:"eager"===l,loading:i,async:"async"===l,deps:[]};if("lazy"===l){const{trigger:t}=e.resolve;var f;t&&Pr.includes(t)&&(null===(f=this.rendererContext)||void 0===f||f.registerArbitraryLifeCycle(t,(()=>{this.updateValue(e.name,void 0,"load")})))}if(e.onChange&&d.eventTarget.addEventListener(this.changeEventType,un(e.onChange,t)),e.track){const n=(0,T.strictCollectMemberUsage)(c?[e.resolve,e.value]:a?e.resolve:e.value,this.type);!a&&(d.deps=[...n]);for(const r of n)this.onChange(r,this.batchAddListener((()=>{d.useResolve=c?wt(e.resolve,t):!!a,d.useResolve?this.updateValue(e.name,{cache:"default"},"refresh"):this.updateValue(e.name,gt(e.value,t),"replace")}),e))}if(d.eventTarget.addEventListener(this.changeEventType,(t=>{this.notifyRealTimeDataChange(e.name,t.detail)})),this.data.set(e.name,d),Array.isArray(r))for(const t of r){const n=this.routeMap.get(t);n?n.add(e.name):this.routeMap.set(t,new Set([e.name]))}return!0}disposeDataInRoutes(e){for(const t of e){const e=this.routeMap.get(t);if(void 0!==e)for(const t of e)this.data.delete(t)}}batchAddListener(e,t){return n=>{this.batchUpdate&&this.batchUpdateContextsNames.includes(t.name)||e(n)}}}function Mr(e,t,n){const{reversedProxies:r,asyncHostPropertyEntries:o,externalSlots:a,tplStateStoreId:i,hostBrick:s}=e;let c;if(t&&r){const e=r.properties.get(t);e&&(d=o,c=e.map((e=>{let{from:t,to:n}=e;const r=d.filter((e=>e[0]===t));if(r.length>0&&n.refProperty)return[n.refProperty,kt(r,t),!0]})).filter(Boolean));const i=r.slots.get(t);if(i&&a){const e=new Map;for(const{from:t,to:r}of i){var l;const o=(null===(l=a[t])||void 0===l?void 0:l.bricks)??[];if(!o.length)continue;const i=r.refSlot??t;let c=e.get(i);if(!c){c=[];const t=(0,u.hasOwnProperty)(n,i)?n[i].bricks.length+1:1;for(let e=0;e<t;e+=1)c.push([]);e.set(i,c)}const d=r.refPosition??-1,f=(0,u.hasOwnProperty)(s.runtimeContext,"forEachItem");c[(0,h.clamp)(d<0?c.length+d:d,0,c.length-1)].push(...f?Lr(o,s.runtimeContext.forEachItem,s.runtimeContext.forEachIndex,s.runtimeContext.forEachSize):o)}for(const[t,r]of e.entries()){(0,u.hasOwnProperty)(n,t)||(n[t]={type:"bricks",bricks:[]});const e=n[t];e.bricks=r.flatMap(((t,n)=>n<e.bricks.length?t.concat(e.bricks[n]):t)),0===e.bricks.length&&delete n[t]}}}var d;return{[Nt]:c,[Ut]:i}}function Lr(e,t,n,r){return e.map((e=>{let{children:o,slots:a,...i}=e;return{...i,[Ft]:t,[jt]:n,[Dt]:r,slots:":forEach"===i.brick?ro(o,a):Object.fromEntries(Object.entries(ro(o,a)??{}).map((e=>{let[o,a]=e;return[o,"routes"===a.type?{type:"routes",routes:$r(a.routes,t,n,r)}:{type:"bricks",bricks:Lr(a.bricks,t,n,r)}]})))}}))}function $r(e,t,n,r){return e.map((e=>"routes"===e.type?{...e,routes:$r(e.routes,t,n,r)}:"redirect"===e.type?e:{...e,bricks:Lr(e.bricks,t,n,r)}))}function Br(e,t){function n(e){return(0,u.isObject)(e)&&"function"!=typeof e?Array.isArray(e)?e.map(n):Object.fromEntries(Object.entries(e).map((e=>{let[t,o]=e;return(0,u.isObject)(o)&&"useBrick"===t?Array.isArray(o)?[t,o.map(r)]:[t,r(o)]:[t,n(o)]})).concat(Object.getOwnPropertySymbols(e).map((t=>[t,e[t]])))):e}function r(e){const{properties:o,slots:a,children:i,...s}=e,c=ro(i,a),l=Object.fromEntries(Object.entries(c??{}).map((e=>{let[t,n]=e;return[t,{type:"bricks",bricks:(n.bricks??[]).map(r)}]})));return{...s,properties:n(o),slots:l,...Mr(t,s.ref,l)}}return n(e)}function Nr(e,t,n,r,o){var a;const i=(0,h.uniqueId)("tpl-state-"),s={...n.runtimeContext,tplStateStoreId:i};delete s.forEachItem,delete s.forEachIndex,delete s.forEachSize,delete s.formStateStoreId;const c=new xr("STATE",n,o,i);s.tplStateStoreMap.set(i,c),s.tplStateStoreScope&&s.tplStateStoreScope.push(c);const{bricks:l,proxy:u,state:d,contracts:f}=Pe.get(e);null==va||null===(a=va.flowApi)||void 0===a||a.collectWidgetContract(f),c.define(d,s,r);const{slots:p,children:m,...g}=t,v={...g,brick:e};n.tplHostMetadata={internalBricksByRef:new Map,tplStateStoreId:i,proxy:u};const b={properties:new Map,slots:new Map};if(null!=u&&u.properties)for(const[e,t]of Object.entries(u.properties)){let n=b.properties.get(t.ref);n||(n=[],b.properties.set(t.ref,n)),n.push({from:e,to:t})}if(null!=u&&u.slots)for(const[e,t]of Object.entries(u.slots)){let n=b.slots.get(t.ref);n||(n=[],b.slots.set(t.ref,n)),n.push({from:e,to:t})}const y={reversedProxies:b,asyncHostPropertyEntries:r,externalSlots:ro(m,p),tplStateStoreId:i,hostBrick:n};return v.slots={"":{type:"bricks",bricks:l.map((e=>Ur(e,y)))}},v}function Ur(e,t){null===e.if&&delete e.if;const{properties:n,slots:r,children:o,...a}=e,i=ro(o,r),s=Object.fromEntries(Object.entries(i??{}).map((e=>{let[n,r]=e;return[n,{type:"bricks",bricks:(r.bricks??[]).map((e=>Ur(e,t)))}]})));return{...a,properties:Br(n,t),slots:s,...Mr(t,a.ref,s)}}const Fr="form-renderer.form-renderer",jr=Symbol.for("form.stateStoreId"),Dr=["forms.general-form","form.general-form","eo-form"];function Kr(e,t,n){const{id:r,bricks:o,events:a,context:i,mountPoint:s,instanceId:c}=e;let{brick:l,properties:d}=e;const f=t.find((e=>e.fieldId===r));if(f){const e=function(e){let t;const n={id:e.fieldId,name:e.fieldId,label:e.name,dataset:{testid:e.fieldId}},r=()=>{var t,n;return{readOnly:null===(t=e.limit)||void 0===t?void 0:t.includes("READONLY"),required:null===(n=e.limit)||void 0===n?void 0:n.includes("REQUIRED")}};switch(e.fieldType){case"INT":t={brick:"forms.general-input-number",properties:{...n,...r(),placeholder:e.description,precision:0,inputBoxStyle:{width:"100%"}}};break;case"BOOLEAN":t={brick:"forms.general-switch",properties:{...n,...r()}};break;case"FLOAT":t={brick:"forms.general-input-number",properties:{...n,...r(),placeholder:e.description,inputBoxStyle:{width:"100%"}}};break;case"ENUM":t={brick:"forms.general-select",properties:{...n,...r(),options:[{label:"选项一",value:1},{label:"选项二",value:2}],placeholder:e.description,inputBoxStyle:{width:"100%"}}};break;case"ENUMS":t={brick:"forms.general-select",properties:{...n,...r(),mode:"multiple",options:[{label:"选项一",value:1},{label:"选项二",value:2}],placeholder:e.description,inputBoxStyle:{width:"100%"}}};break;case"DATE":case"TIME":t={brick:"forms.general-date-picker",properties:{...n,...r(),placeholder:e.description}};break;case"IP":t={brick:"forms.general-input",properties:{...n,...r(),placeholder:e.description,pattern:"((^s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))s*$)|(^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$))",message:{pattern:"输入字符不匹配IP格式"}}};break;case"JSON":t={brick:"forms.general-textarea",properties:{...n}};break;case"ARRAY":t={brick:"forms.general-select",properties:{...n}};break;case"STRUCTURE":case"STRUCTURE_ARRAY":t={brick:"forms.cmdb-instance-select-panel",properties:{...n,...r()}};break;default:t={brick:"forms.general-input",properties:{...n,...r(),placeholder:e.description}}}return t}(f);l||(l=e.brick),d={...e.properties,...d}}const p={brick:l,properties:d,iid:c,slot:s,events:a,context:i,children:Vr(o,t,n),[jr]:n};return(0,u.hasOwnProperty)(e,"if")&&(p.if=e.if),p}function Vr(e,t,n){if(Array.isArray(e))return e.map((e=>Kr(e,t,n)))}var Wr=new WeakSet;class Hr extends HTMLElement{constructor(){super(...arguments),(0,I.A)(this,Wr),(0,o.A)(this,"renderRoot",void 0)}get $$typeof(){return"formRenderer"}validate(){(0,C.A)(Wr,this,zr).call(this,"validate")}setInitValue(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];(0,C.A)(Wr,this,zr).call(this,"setInitValue",t)}resetFields(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];(0,C.A)(Wr,this,zr).call(this,"resetFields",t)}}function zr(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const o=!1!==this.renderRoot?null===(t=this.firstElementChild)||void 0===t?void 0:t.firstElementChild:this.firstElementChild,a=null==o||null===(n=o.tagName)||void 0===n?void 0:n.toLowerCase();Dr.includes(a)?o[e](...r):console.error(`no ${e} method in the container element`,{container:a})}class Gr extends Error{constructor(e){super(e),this.name="PageNotFoundError",Error.captureStackTrace&&Error.captureStackTrace(this,l.BrickLoadError)}}async function qr(e,t,n){const{title:r,variant:o,showLink:a,showDescription:i}=function(e){var t,n;return e instanceof Gr?"app not found"===e.message?{showLink:"home",title:c.i18n.t(`${zt}:${Vt.APP_NOT_FOUND}`),variant:"no-permission"}:{showLink:"home",variant:"not-found",title:c.i18n.t(`${zt}:${Vt.PAGE_NOT_FOUND}`)}:e instanceof l.BrickLoadError||e instanceof Error&&"ChunkLoadError"===e.name?{showDescription:!0,title:c.i18n.t(`${zt}:${Vt.NETWORK_ERROR}`),variant:"internet-disconnected"}:e instanceof R.HttpResponseError&&403===(null===(t=e.response)||void 0===t?void 0:t.status)?{showLink:"previous",showDescription:!0,title:c.i18n.t(`${zt}:${Vt.NO_PERMISSION}`),variant:"no-permission"}:e instanceof R.HttpResponseError&&"200000"===(null===(n=e.responseJson)||void 0===n?void 0:n.code)?{showDescription:!0,title:c.i18n.t(`${zt}:${Vt.LICENSE_EXPIRED}`),variant:"license-expired"}:{showLink:"previous",showDescription:!0,title:c.i18n.t(`${zt}:${Vt.UNKNOWN_ERROR}`),variant:"unknown-error"}}(e);if(n){const n=ka().error??"illustrations.error-message";if(!1!==n){const s="eo-link",u=a?[n,s]:[n];try{await Promise.race([(0,l.loadBricksImperatively)(u,Aa()),new Promise(((e,t)=>setTimeout((()=>{t(new Error("timeout"))}),3e3)))]);const d={tag:_n.BRICK,type:n,properties:{errorTitle:r,description:i?Jt(e):void 0,variant:o,dataset:{errorBoundary:""}},runtimeContext:null,return:t};return a&&(d.child={tag:_n.BRICK,type:s,properties:{textContent:"home"===a?c.i18n.t(`${zt}:${Vt.GO_BACK_HOME}`):c.i18n.t(`${zt}:${Vt.GO_BACK_TO_PREVIOUS_PAGE}`),url:"home"===a?"/":void 0},events:"home"===a?void 0:{click:{action:"history.goBack"}},runtimeContext:null,return:d}),d}catch(e){console.error("Failed to load brick:",u.join(", "),e)}}}return{tag:_n.BRICK,type:"div",properties:{textContent:i?`${r}: ${Jt(e)}`:r,dataset:{errorBoundary:""},style:{color:"var(--color-error)"}},runtimeContext:null,return:t}}async function Yr(e,t,n,r,o,a,i,s){const c=await async function(e,t){for(const n of e){if("string"!=typeof n.path)throw console.error("Invalid route with invalid path:",n),new Error("Invalid route with invalid type of path: "+typeof n.path);const e=Bt(n,t.app.homepage,t.location.pathname);if(e&&await yt(n,t))return t.app.noAuthGuard||n.public||null==va||!va.auth||va.auth.isLoggedIn()?{match:e,route:n}:"unauthenticated"}return"missed"}(t,n),u={blockingList:[]},d=u.menuRequestNode={return:a};switch(c){case"missed":break;case"unauthenticated":u.unauthenticated=!0;break;default:{var f;const a=u.route=c.route;u.path=c.match.path;const m={...n,match:c.match};a.iid&&(p=a.iid,h=c.match,nr.set(p,h)),s&&m.ctxStore.disposeDataInRoutes(t);const g=o.concat(a);m.ctxStore.define(a.context,m,void 0,g),m.pendingPermissionsPreCheck.push(null==va||null===(f=va.checkPermissions)||void 0===f?void 0:f.preCheckPermissionsForBrickOrRoute(a,(e=>mt(e,m))));const{preLoadBricks:v}=a;if(Array.isArray(v)&&u.blockingList.push((0,l.loadBricksImperatively)(v,Aa())),"redirect"===a.type){let e;if(e="string"==typeof a.redirect?await mt(a.redirect,m):(await tt({transform:"redirect",...a.redirect},m)).redirect,"string"!=typeof e)throw console.error("Unexpected redirect result:",e),new Error("Unexpected type of redirect result: "+typeof e);u.redirect={path:e}}else{const n=function(e,t){if(e){if("brick"===e.type)throw console.error("Set menu with brick is dropped in v3:",e),new Error("Set menu with brick is dropped in v3");if("resolve"!==e.type)return mt(e,t);console.warn("Set menu with resolve is not supported in v3 yet:",e)}}(a.menu,m);let o;n&&(d.request=n),s||r.memoizeMenuRequestNode(t,d),o="routes"===a.type?await Yr(e,a.routes,m,r,g,d,i):await Xr(e,a.bricks,m,r,g,d,i),to(u,o),no(d,o.menuRequestNode)}}}var p,h;return u}async function Xr(e,t,n,r,o,a,i,s,c){!function(e,t,n){function r(e){if((0,u.isObject)(e)&&"function"!=typeof e)if(Array.isArray(e))e.map(r);else for(const[t,n]of Object.entries(e))(0,u.isObject)(n)&&"useBrick"===t?Array.isArray(n)?n.forEach((e=>o(e,!0))):o(n,!0,!0):r(n)}function o(e,a,i){if(a&&(e[or]=t),r(e.properties),n&&!i)return;const s=ro(e.children,e.slots);for(const e of Object.values(s??{}))for(const t of e.bricks??[])o(t,a)}for(const t of e)o(t)}(t,n,!0);const l={blockingList:[]},d=c??[];return(await Promise.all(t.map(((t,c)=>Jr(e,t,n,r,o,a,i,d.concat(c),s&&new Map(s)))))).forEach(((t,n)=>{t.hasTrackingControls&&r.memoize(i,d.concat(n),t.node,e),to(l,t)})),l}async function Jr(e,t,n,r,o,a,i){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new Map;try{return await async function(e,t,n,r,o,a,i,s,c){var d,f;const p={blockingList:[]};if(!t.brick)return t.template?console.error("Legacy templates are dropped in v3:",t):console.error("Invalid brick:",t),p;const{if:m,permissionsPreCheck:v,...b}=t;if(function(e){return"string"==typeof e?(0,O.isTrackAll)(e):at(e)&&(0,O.isTrackAll)(it(e))}(m))return Jr(e,{brick:":if",dataSource:m,permissionsPreCheck:v,slots:{"":{type:"bricks",bricks:[b]}},...Object.getOwnPropertySymbols(t).reduce(((e,n)=>({...e,[n]:t[n]})),{})},n,r,o,a,i,s,c);const y=t[Ut],w=t[jr],E={...n,tplStateStoreId:y,formStateStoreId:w};(0,u.hasOwnProperty)(t,Ft)&&(E.forEachItem=t[Ft],E.forEachIndex=t[jt],E.forEachSize=t[Dt]);const{context:S}=t;if(Array.isArray(S)&&S.length>0){const e=Re(E);Oe(e,"Defining context on bricks","check your brick:",t),e||E.ctxStore.define(S,E)}if(E.pendingPermissionsPreCheck.push(null==va||null===(d=va.checkPermissions)||void 0===d?void 0:d.preCheckPermissionsForBrickOrRoute(t,(e=>mt(e,E)))),!await async function(e,t){return(0,u.isObject)(e.if)&&!at(e.if)?Et(await tt(e.if,t)):yt(e,t)}(t,E))return p;const A=t.brick;if(A.startsWith(":")){!function(e){if(":forEach"!==e&&":if"!==e&&":switch"!==e)throw new Error(`Unknown storyboard control node: "${e}"`)}(A);const{dataSource:n}=t,l=async l=>{var d;const f=await mt(n,l),p=":forEach"===A?"":":switch"===A?String(f):f?"":"else",h=ro(t.children,t.slots),m=h&&(0,u.hasOwnProperty)(h,p)&&(null===(d=h[p])||void 0===d?void 0:d.bricks);if(!Array.isArray(m))return{blockingList:[]};switch(A){case":forEach":return Array.isArray(f)?async function(e,t,n,r,o,a,i,s,c,l){const u={blockingList:[]},d=t.length,f=await Promise.all(t.map(((t,u)=>Promise.all(n.map(((n,f)=>Jr(e,n,{...r,forEachItem:t,forEachIndex:u,forEachSize:d},o,a,i,s,l.concat(u*d+f),c&&new Map(c))))))));return f.flat().forEach(((t,n)=>{t.hasTrackingControls&&o.memoize(s,l.concat(n),t.node,e),to(u,t)})),u}(e,f,m,l,r,o,a,i,c,s):{blockingList:[]};case":if":case":switch":return Xr(e,m,l,r,o,a,i,c,s)}},d=async t=>{const n=await l(t);return n.node??(n.node={tag:_n.PLACEHOLDER,return:e}),n},f=await d(E),{onMount:p,onUnmount:m}=t.lifeCycle??{},{contextNames:g,stateNames:v}=At(n);if(g||v){f.hasTrackingControls=!0;let t=0;const o=async()=>{const n=++t,[o,a,c]=eo(E),l=await d(o),u=[...a,...c];if(await Zr(l,o,u),t===n){m&&un(m,E)(new CustomEvent("unmount",{detail:{rerender:!0}})),r.reRender(i,s,l.node,e),p&&un(p,o)(new CustomEvent("mount",{detail:{rerender:!0}}));for(const e of u)e.mountAsyncData()}},a=(0,h.debounce)(o,0,{leading:!0,trailing:!0});if(g)for(const e of g)E.ctxStore.onChange(e,a);if(v)for(const e of v)xe(E,"STATE",`: "${n}"`).onChange(e,a)}return p&&r.registerArbitraryLifeCycle("onMount",(()=>{un(p,E)(new CustomEvent("mount",{detail:{rerender:!1}}))})),m&&r.registerArbitraryLifeCycle("onUnmount",(()=>{un(m,E)(new CustomEvent("unmount",{detail:{rerender:!1}}))})),f}/\.tpl-/.test(A)&&!Pe.get(A)&&await oo((0,l.loadBricksImperatively)([A],Aa()),"brick",A,r.unknownBricks);const k=function(e,t){if(!e.includes(".")&&e.startsWith("tpl-")&&t){const n=`${t}.${e}`;if(Pe.get(n))return n}return!!Pe.get(e)&&e}(A,null===(f=E.app)||void 0===f?void 0:f.id);if(k){const e=c.get(k)??0;if(e>=10)throw new Error(`Maximum custom template stack overflowed: "${k}"`);c.set(k,e+1)}else A.includes("-")&&!customElements.get(A)&&(A===Fr?customElements.get(Fr)||customElements.define(Fr,Hr):p.blockingList.push(oo((0,l.enqueueStableLoadBricks)([A],Aa()),"brick",A,r.unknownBricks)));let I,C;var R;A===Fr?(({formData:I,...C}=t.properties??{}),null!==(R=t.properties)&&void 0!==R&&R.compute&&(I=await mt(I,E))):C=t.properties;const _=[],P=function(e,t,n){return(0,u.isObject)(e)?Object.entries(e).map((e=>{let[r,o]=e;const{contextNames:a,stateNames:i,formStateNames:s}=At(o);return(a||i||s)&&n.push({contextNames:a,stateNames:i,formStateNames:s,propName:r,propValue:o}),[r,mt(o,t,{$$lazyForUseBrick:!0,$$stateOfUseBrick:"useBrick"===r?ft.USE_BRICK:ft.INITIAL})]})):[]}(C,E,_),x=t[Nt];x&&P.push(...x);const M="script"===A;if(M||"link"===A){const e=await It(P);if(M?e.src:"stylesheet"===e.rel&&e.href){const t=window.PUBLIC_ROOT??"";if(M){const{src:n,...r}=e;await oo((0,l.loadScript)(n,t,r),"script",n,"silent")}else{const{href:n,...r}=e;await oo((0,l.loadStyle)(n,t,r),"stylesheet",n,"silent")}return p}}const L={tag:_n.BRICK,type:k||A,return:e,slotId:i,events:t.events,runtimeContext:E,portal:t.portal,iid:t.iid,ref:t.ref};p.node=L;const $=(0,T.strictCollectMemberUsage)([t.events,t.lifeCycle],"PROCESSORS",2);$.size>0&&p.blockingList.push(oo((0,l.loadProcessorsImperatively)($,Aa()),"processors",[...$].join(", "),r.unknownBricks));const B=[];B.push((async()=>{L.properties=await It(P),function(e,t){for(const n of t){const t=()=>{e.element&&Rt(e.element,{[n.propName]:n.propValue},e.runtimeContext)};if(n.contextNames)for(const r of n.contextNames)e.runtimeContext.ctxStore.onChange(r,t);if(n.stateNames){const r=xe(e.runtimeContext,"STATE",`: "${n.propValue}"`);for(const e of n.stateNames)r.onChange(e,t)}if(n.formStateNames){const r=qe(e.runtimeContext,"FORM_STATE",`: "${n.propValue}"`);for(const e of n.formStateNames)r.onChange(e,t)}}}(L,_)})()),r.registerBrickLifeCycle(L,t.lifeCycle);let N,U=t;k?U=Nr(k,t,L,P,r):A===Fr&&(U=function(e,t,n,r,o){var a;const i="string"==typeof e?JSON.parse(e):e,s=(0,h.uniqueId)("form-state-"),c={...n.runtimeContext,formStateStoreId:s};delete c.forEachItem,delete c.forEachIndex,delete c.forEachSize,delete c.tplStateStoreId;const l=new xr("FORM_STATE",void 0,o,s);c.formStateStoreMap.set(s,l),c.formStateStoreScope&&c.formStateStoreScope.push(l);const d=i.context??[];d.some((e=>"params"===e.name))||d.push({name:"params"}),l.define(d,c,r);const f=Kr(i.formSchema,i.fields,s);return Dr.includes(f.brick)&&t.events&&(f.events=function(e,t){const n=e??{};for(const[e,r]of Object.entries(t))n[e]=(0,u.hasOwnProperty)(n,e)?[n[e],r].flat():r;return n}(f.events,t.events)),"boolean"!=typeof(null===(a=t.properties)||void 0===a?void 0:a.renderRoot)||t.properties.renderRoot?{...t,slots:void 0,children:[{brick:"eo-micro-view",properties:{style:{padding:"12px"}},children:[f]}]}:{...t,slots:void 0,children:[f]}}(I,t,L,P,r)),U.portal&&(L.slotId=void 0),k?(N={...E},delete N.forEachItem,delete N.forEachIndex,delete N.forEachSize):N=E;return B.push((async()=>{const e=ro(U.children,U.slots);if(!e)return;const t=new Map,n=await Promise.all(Object.entries(e).map(((e,n)=>{let[i,s]=e;if("routes"!==s.type)return Xr(L,s.bricks,N,r,o,a,i,c);const l=o[o.length-1];return null!=l&&l.incrementalSubRoutes&&(t.set(n,i),r.performIncrementalRender(s,o,(async(e,t)=>{const{homepage:n}=N.app,{pathname:c}=e;if(!g(n,c)||!o.every((e=>{let r,o;return(r=Bt(e,n,t.pathname))&&(o=Bt(e,n,c))&&(e!==l||(0,h.isEqual)(r.params,o.params))})))return!1;const[u,d,f]=eo({...N,location:e,query:new URLSearchParams(e.search)});let p,m=!1,v=[];try{if(p=await Yr(L,s.routes,u,r,o,a,i,!0),p.route){if(r.reBailout(p))return!0;v=[...d,...f],await Zr(p,u,[u.ctxStore,...v])}await r.reMergeMenuRequestNodes(a,s.routes,p.menuRequestNode)}catch(e){console.error("Incremental sub-router failed:",e);const t=await r.reCatch(e,L);if(!t)return!0;({failed:m,output:p}=t),await r.reMergeMenuRequestNodes(a,s.routes,p.menuRequestNode)}if(r.reRender(i,[],p.node,L),!m){u.ctxStore.mountAsyncData(p.route);for(const e of v)e.mountAsyncData()}return!!p.route||null}))),Yr(L,s.routes,N,r,o,a,i)}))),i={...p,node:void 0,blockingList:[],menuRequestNode:void 0};n.forEach(((e,n)=>{t.has(n)&&r.memoize(t.get(n),[],e.node,L),to(i,e),function(e,t){const n=t.menuRequestNode;if(n)if(e.menuRequestNode){let t=e.menuRequestNode;for(;t.sibling;)t=t.sibling;t.sibling=n}else e.menuRequestNode=n}(i,e)})),i.node&&(L.child=i.node),to(p,{...i,node:void 0}),no(a,p.menuRequestNode=i.menuRequestNode)})()),await Promise.all(B),p}(e,t,n,r,o,a,i,s,c)}catch(n){if(t.errorBoundary)return console.error("Error caught by error boundary:",n),{node:await qr(n,e),blockingList:[]};throw n}}function Qr(e){return[e.ctxStore,...e.tplStateStoreMap.values(),...e.formStateStoreMap.values()]}function Zr(e,t,n){return(0,l.flushStableLoadBricks)(),Promise.all([...e.blockingList,...n.map((e=>e.waitForAll())),...t.pendingPermissionsPreCheck])}function eo(e){const t=[],n=[];return[{...e,tplStateStoreScope:t,formStateStoreScope:n},t,n]}function to(e,t){const{blockingList:n,node:r,menuRequestNode:o,hasTrackingControls:a,...i}=t;if(e.blockingList.push(...n),r)if(e.node){let t=e.node;for(;t.sibling;)t=t.sibling;t.sibling=r}else e.node=r;Object.assign(e,i)}function no(e,t){if(t)if(e.child){let n=e.child;for(;n.sibling;)n=n.sibling;n.sibling=t}else e.child=t}function ro(e,t){let n=t;if(Array.isArray(e)&&!n){n={};for(const t of e){const e=t.slot??"";(0,u.hasOwnProperty)(n,e)||(n[e]={type:"bricks",bricks:[]}),n[e].bricks.push(t)}}return n}function oo(e,t,n,r){return"silent"===r?e.catch((e=>{console.error('Load %s "%s" failed:',t,n,e)})):e}let ao,io,so;function co(){if(!ao){if(ao={isInIframe:!1,isInIframeOfSameSite:!1,isInIframeOfNext:!1,isInIframeOfVisualBuilder:!1,isInIframeOfLegacyConsole:!1},window!==window.parent){ao.isInIframe=!0;try{if(window.origin===window.parent.origin){ao.isInIframeOfSameSite=!0;const e="/next/"===p(),t=window.parent.location.pathname,n=t.startsWith("/next/");ao.isInIframeOfNext=0==(Number(e)^Number(n));const r=n?"/next":"";ao.isInIframeOfVisualBuilder=t.startsWith(`${r}/visual-builder/`)||t.startsWith(`${r}/visual-builder-`),ao.isInIframeOfLegacyConsole=e&&!n}}catch{}}Object.freeze(ao)}return ao}function lo(e){var t;if(e.$$registerCustomTemplateProcessed)return;e.$$registerCustomTemplateProcessed=!0;const n=null===(t=e.meta)||void 0===t?void 0:t.customTemplates;if(Array.isArray(n))for(const t of n){const n=t.name.includes(".")?t.name:`${e.app.id}.${t.name}`;Pe.define(n,t)}}function uo(e){let t;t="8.2"===e?"v8-2":"v8",document.documentElement.dataset.ui=t}const fo="basic.show-watermark";var po=new WeakMap,ho=new WeakMap,mo=new WeakMap,go=new WeakMap,vo=new WeakMap,bo=new WeakMap,yo=new WeakMap,wo=new WeakMap,Eo=new WeakMap,So=new WeakMap,Ao=new WeakMap,ko=new WeakSet;class Io{constructor(e){(0,I.A)(this,ko),(0,a.A)(this,po,void 0),(0,a.A)(this,ho,!1),(0,a.A)(this,mo,void 0),(0,a.A)(this,go,void 0),(0,a.A)(this,vo,void 0),(0,a.A)(this,bo,new Set),(0,a.A)(this,yo,0),(0,a.A)(this,wo,void 0),(0,a.A)(this,Eo,void 0),(0,a.A)(this,So,void 0),(0,a.A)(this,Ao,void 0),(0,i.A)(po,this,e);const t=k();window.addEventListener("beforeunload",(e=>{(0,C.A)(ko,this,Co).call(this,{})?(e.preventDefault(),e.returnValue=""):delete e.returnValue})),t.block(((e,t)=>(0,C.A)(ko,this,Co).call(this,{location:e,action:t})))}getRenderId(){return(0,s.A)(wo,this)}getRuntimeContext(){return(0,s.A)(go,this)}getRecentApps(){return{currentApp:(0,s.A)(Eo,this),previousApp:(0,s.A)(So,this)}}getNavConfig(){return(0,s.A)(Ao,this)}bootstrap(){window.AbortController&&(io=new AbortController,R.http.interceptors.request.use((e=>{var t;return{...e,options:{...e.options,signal:null!==(t=e.options)&&void 0!==t&&t.noAbortOnRouteChange?null:io.signal}}})));const e=k();let t=e.location;return e.listen(((e,n)=>{const r=t;t=e,(0,s.A)(ho,this)?(0,i.A)(mo,this,{location:e,prevLocation:r,action:n}):(0,C.A)(ko,this,Oo).call(this,{location:e,prevLocation:r,action:n}).catch(nn)})),(0,C.A)(ko,this,Oo).call(this,{location:e.location})}}function Co(e){var t;const n=k(),r=n.getBlockMessage();null===(t=(0,s.A)(vo,this))||void 0===t||t.dispatchBeforePageLeave(e);const o=n.getBlockMessage();return!r&&o&&n.unblock(),o}function Ro(e,t,n){var r,o;if((0,i.A)(yo,this,(r=(0,s.A)(yo,this),o=r++,r)),o>10){const t=`Infinite redirect detected: from "${n.pathname}${n.search}${n.hash}" to "${e}"`;throw new Error(t)}k().replace(e,t)}async function Oo(e){(0,i.A)(ho,this,!0);try{await(0,C.A)(ko,this,To).call(this,e)}finally{if((0,i.A)(ho,this,!1),(0,s.A)(mo,this)){const e=(0,s.A)(mo,this);(0,i.A)(mo,this,void 0),await(0,C.A)(ko,this,Oo).call(this,e)}}}async function To(e){let{location:t,prevLocation:n,action:r}=e;if(n){var o,a,i,c;let e;const u={hash:void 0,state:void 0};var l;if(void 0!==t.key&&("POP"!==r||void 0!==n.key&&!1!==(null===(o=n.state)||void 0===o?void 0:o.notify))||(u.key=void 0),((0,f.locationsAreEqual)({...n,...u},{...t,...u})||"POP"!==r&&!1===(null===(a=t.state)||void 0===a?void 0:a.notify))&&(e=!0),e||null!==(i=t.state)&&void 0!==i&&i.noIncremental||(e=await(null===(l=(0,s.A)(vo,this))||void 0===l?void 0:l.didPerformIncrementalRender(t,n))),e)return;if(io&&(io.abort(),io=new AbortController),null===(c=(0,s.A)(vo,this))||void 0===c||c.dispatchPageLeave(),"POP"===r&&v(m((0,s.A)(po,this),t.pathname)))return void window.location.reload();V("locationChange")}return(0,C.A)(ko,this,_o).call(this,t)}async function _o(e){var t,n,r,o;const a=(0,i.A)(wo,this,(0,h.uniqueId)("render-id-"));Je=new WeakSet,et.clear(),null==va||null===(t=va.flowApi)||void 0===t||t.clearCollectWidgetContract(),k().unblock();const c=null==va||null===(n=va.pageView)||void 0===n?void 0:n.create(),u=m((0,s.A)(po,this),e.pathname),d=null===(r=(0,s.A)(go,this))||void 0===r?void 0:r.app,f=null==u||null===(o=u.app)||void 0===o?void 0:o.id;window.BOOTSTRAP_UNION_FILE&&f&&f!==(null==d?void 0:d.id)&&function(e){const{appId:t,version:n}=e;window.APP_ROOT_TPL&&(window.APP_ID=t,window.APP_ROOT=window.APP_ROOT_TPL.replace("{id}",t).replace("{version}",n))}({appId:f,version:u.app.currentVersion}),null!=u&&u.app&&await async function(e){if(!e.$$fulfilled)return e.$$fulfilling||(e.$$fulfilling=async function(e){var t;await(null==va||null===(t=va.fulfilStoryboard)||void 0===t?void 0:t.call(va,e)),L(e),Object.assign(e,{$$fulfilled:!0,$$fulfilling:null})}(e)),e.$$fulfilling}(u);const p=(0,i.A)(Eo,this,null==u?void 0:u.app);!function(){var e,t,n,r,o;const a=ya().getFeatureFlags(),i=ya().getMiscSettings();if(!a["show-watermark"])return;const s="0.0.0"===(null===(e=window.APP_ROOT)||void 0===e||null===(e=e.match(/versions\/([^/]+)\//))||void 0===e?void 0:e[1])||"0.0.0"===(null===(t=window.APP_ROOT)||void 0===t||null===(t=t.match(/micro-apps\/(?:v2|v3)\/[^/]+\/([^/]+)/))||void 0===t?void 0:t[1]),c=(null==va||null===(n=va.auth)||void 0===n||null===(n=n.getAuth())||void 0===n?void 0:n.username)??"",u=i.watermarkConfig??{flags:{}},d=[..."string"==typeof u.content?[u.content]:u.content??[],null!==(r=u.flags)&&void 0!==r&&r["show-development"]&&s?"Development":"",null!==(o=u.flags)&&void 0!==o&&o["show-user"]?c:""].filter(Boolean);if(0===d.length)return;const f={content:d,zIndex:1001,width:200,font:{fontSize:28},gap:[190,190],...(0,h.omit)(u,["content","flags"])};so?so.resolve(f):(0,l.loadBricksImperatively)([fo],Aa()).then((()=>{so=document.createElement(fo),so.resolve(f)}),(e=>{console.error("Load watermark service failed:",e)}))}();const g=d&&p?d.id!==p.id:d!==p;(0,O.clearExpressionASTCache)(),g&&(0,O.clearFunctionASTCache)();const v=ya().getFeatureFlags(),b=(0,s.A)(vo,this),y=(t,n)=>{null==c||c({status:"redirected"}),(0,s.A)(bo,this).add(b),(0,C.A)(ko,this,Ro).call(this,t,n,e)},w=()=>{const t=v["sso-enabled"]?"/sso-auth/login":"/auth/login";Xt(e),y(t,{from:e})},E=document.querySelector("#main-mount-point"),S=document.querySelector("#portal-mount-point"),A={tag:_n.ROOT,container:E,createPortal:S},I=()=>{var e;Pn(E),Pn(S),(0,s.A)(bo,this).add(b);for(const e of(0,s.A)(bo,this))e&&(e.dispatchOnUnmount(),e.dispose());(0,s.A)(bo,this).clear(),null==va||null===(e=va.messageDispatcher)||void 0===e||e.reset(),g&&((0,i.A)(So,this,d),window.dispatchEvent(new CustomEvent("app.change",{detail:{previousApp:d,currentApp:p}})))};if(Q(p&&(re()[p.id]||p.theme)||"light"),ae("default"),p){var T,_,P,x,M,$;null==va||null===(T=va.checkInstalledApps)||void 0===T||T.preCheckInstalledApps(u,(e=>!!Oa(e)));const t={bailout:e=>e.unauthenticated?(w(),!0):e.redirect?(y(e.redirect.path,e.redirect.state),!0):void(0,i.A)(yo,this,0),mergeMenus:async e=>{const t=await Promise.all(e);(0,i.A)(Ao,this,function(e){const t={breadcrumb:[]};for(const n of e){const{breadcrumb:e}=n;e&&(e.overwrite?t.breadcrumb=e.items:t.breadcrumb.push(...e.items))}return t}(t)),window.dispatchEvent(new CustomEvent("navConfig.change",{detail:(0,s.A)(Ao,this)}))},catch:async(t,n)=>{if(!Qt(t)||window.NO_AUTH_GUARD){if(!(t instanceof R.HttpAbortError)){const r=ya().getMiscSettings().noAuthGuardLoginPath;return Qt(t)&&r?void y(r,{from:e}):{failed:!0,output:{node:await qr(t,n,!0),blockingList:[]}}}(0,s.A)(bo,this).add(b)}else w()}},n=(0,i.A)(vo,this,new Hn("page",{routeHelper:t,renderId:a})),r=(0,i.A)(go,this,{app:p,location:e,query:new URLSearchParams(e.search),flags:v,sys:{...null==va||null===(_=va.auth)||void 0===_?void 0:_.getAuth(),...co(),settings:{brand:ya().getBrandSettings()}},ctxStore:new xr("CTX",void 0,n),pendingPermissionsPreCheck:[null==va||null===(P=va.checkPermissions)||void 0===P?void 0:P.preCheckPermissions(u)],tplStateStoreMap:new Map,formStateStoreMap:new Map});(0,i.A)(Ao,this,void 0),lo(u),me(null===(x=u.meta)||void 0===x?void 0:x.functions,p),null==va||null===(M=va.flowApi)||void 0===M||M.collectContract(null===($=u.meta)||void 0===$?void 0:$.contracts);let o,l=!1,d=[];try{nr.clear();const e={};if(o=await Yr(A,function(e){if(window.parent===window)return e;let t=e;const n=(0,h.findLastIndex)(t,(e=>e.path.startsWith("${APP.homepage}/_dev_only_/template-preview/")));t=[...t.slice(0,n+1),{path:"${APP.homepage}/_dev_only_/template-preview/:templateId",bricks:[{brick:"span"}],menu:!1,exact:!0},...t.slice(n+1)];const r=(0,h.findLastIndex)(t,(e=>e.path.startsWith("${APP.homepage}/_dev_only_/snippet-preview/")));return t=[...t.slice(0,r+1),{path:"${APP.homepage}/_dev_only_/snippet-preview/:snippetId",bricks:[{brick:"span"}],menu:!1,exact:!0},...t.slice(r+1)],t}(u.routes),r,n,[],e),t.bailout(o))return;d=Qr(r),await Zr(o,r,d),e.child=o.menuRequestNode,n.setInitialMenuRequestNode(e),await t.mergeMenus(n.getMenuRequests())}catch(e){console.error("Router failed:",e);const n=await t.catch(e,A);if(!n)return;({failed:l,output:o}=n)}if(A.child=o.node,I(),o.route&&"routes"!==o.route.type||l){if(l||n.dispatchBeforePageLoad(),te(),se(),uo(null==p?void 0:p.uiVersion),xn(A),window.scrollTo(0,0),l)null==c||c({status:"failed"});else{n.dispatchPageLoad(),n.dispatchAnchorLoad(),n.dispatchOnMount(),n.initializeScrollIntoView(),n.initializeMediaChange(),n.initializeMessageDispatcher();for(const e of d)e.mountAsyncData();null==c||c({status:"ok",path:o.path,pageTitle:document.title})}return void V("rendered")}}else{if(!window.NO_AUTH_GUARD&&null!=va&&va.auth&&!va.auth.isLoggedIn())return void w();I()}te(),se();const B=await qr(new Gr(p?"page not found":"app not found"),A,!0);A.child=B,xn(A),window.scrollTo(0,0),null==c||c({status:"not-found"}),V("rendered")}const Po="undefined"!=typeof BRICK_PACKAGES?BRICK_PACKAGES:null;function xo(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function Mo(e){return e<=1?"".concat(100*Number(e),"%"):e}function Lo(e){return 1===e.length?"0"+e:String(e)}function $o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Bo(e){return No(e)/255}function No(e){return parseInt(e,16)}var Uo={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Fo(e){var t,n,r,o={r:0,g:0,b:0},a=1,i=null,s=null,c=null,l=!1,u=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(Uo[e])e=Uo[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=Vo.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=Vo.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=Vo.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=Vo.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=Vo.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=Vo.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=Vo.hex8.exec(e))?{r:No(n[1]),g:No(n[2]),b:No(n[3]),a:Bo(n[4]),format:t?"name":"hex8"}:(n=Vo.hex6.exec(e))?{r:No(n[1]),g:No(n[2]),b:No(n[3]),format:t?"name":"hex"}:(n=Vo.hex4.exec(e))?{r:No(n[1]+n[1]),g:No(n[2]+n[2]),b:No(n[3]+n[3]),a:Bo(n[4]+n[4]),format:t?"name":"hex8"}:!!(n=Vo.hex3.exec(e))&&{r:No(n[1]+n[1]),g:No(n[2]+n[2]),b:No(n[3]+n[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(Wo(e.r)&&Wo(e.g)&&Wo(e.b)?(t=e.r,n=e.g,r=e.b,o={r:255*xo(t,255),g:255*xo(n,255),b:255*xo(r,255)},l=!0,u="%"===String(e.r).substr(-1)?"prgb":"rgb"):Wo(e.h)&&Wo(e.s)&&Wo(e.v)?(i=Mo(e.s),s=Mo(e.v),o=function(e,t,n){e=6*xo(e,360),t=xo(t,100),n=xo(n,100);var r=Math.floor(e),o=e-r,a=n*(1-t),i=n*(1-o*t),s=n*(1-(1-o)*t),c=r%6;return{r:255*[n,i,a,a,s,n][c],g:255*[s,n,n,i,a,a][c],b:255*[a,a,s,n,n,i][c]}}(e.h,i,s),l=!0,u="hsv"):Wo(e.h)&&Wo(e.s)&&Wo(e.l)&&(i=Mo(e.s),c=Mo(e.l),o=function(e,t,n){var r,o,a;if(e=xo(e,360),t=xo(t,100),n=xo(n,100),0===t)o=n,a=n,r=n;else{var i=n<.5?n*(1+t):n+t-n*t,s=2*n-i;r=$o(s,i,e+1/3),o=$o(s,i,e),a=$o(s,i,e-1/3)}return{r:255*r,g:255*o,b:255*a}}(e.h,i,c),l=!0,u="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(a=e.a)),a=function(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}(a),{ok:l,format:e.format||u,r:Math.min(255,Math.max(o.r,0)),g:Math.min(255,Math.max(o.g,0)),b:Math.min(255,Math.max(o.b,0)),a}}var jo="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Do="[\\s|\\(]+(".concat(jo,")[,|\\s]+(").concat(jo,")[,|\\s]+(").concat(jo,")\\s*\\)?"),Ko="[\\s|\\(]+(".concat(jo,")[,|\\s]+(").concat(jo,")[,|\\s]+(").concat(jo,")[,|\\s]+(").concat(jo,")\\s*\\)?"),Vo={CSS_UNIT:new RegExp(jo),rgb:new RegExp("rgb"+Do),rgba:new RegExp("rgba"+Ko),hsl:new RegExp("hsl"+Do),hsla:new RegExp("hsla"+Ko),hsv:new RegExp("hsv"+Do),hsva:new RegExp("hsva"+Ko),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Wo(e){return Boolean(Vo.CSS_UNIT.exec(String(e)))}var Ho=2,zo=.16,Go=.05,qo=.05,Yo=.15,Xo=5,Jo=4,Qo=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function Zo(e){var t=function(e,t,n){e=xo(e,255),t=xo(t,255),n=xo(n,255);var r=Math.max(e,t,n),o=Math.min(e,t,n),a=0,i=r,s=r-o,c=0===r?0:s/r;if(r===o)a=0;else{switch(r){case e:a=(t-n)/s+(t<n?6:0);break;case t:a=(n-e)/s+2;break;case n:a=(e-t)/s+4}a/=6}return{h:a,s:c,v:i}}(e.r,e.g,e.b);return{h:360*t.h,s:t.s,v:t.v}}function ea(e){var t=e.r,n=e.g,r=e.b;return"#".concat(function(e,t,n,r){var o=[Lo(Math.round(e).toString(16)),Lo(Math.round(t).toString(16)),Lo(Math.round(n).toString(16))];return o.join("")}(t,n,r))}function ta(e,t,n){var r;return(r=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-Ho*t:Math.round(e.h)+Ho*t:n?Math.round(e.h)+Ho*t:Math.round(e.h)-Ho*t)<0?r+=360:r>=360&&(r-=360),r}function na(e,t,n){return 0===e.h&&0===e.s?e.s:((r=n?e.s-zo*t:t===Jo?e.s+zo:e.s+Go*t)>1&&(r=1),n&&t===Xo&&r>.1&&(r=.1),r<.06&&(r=.06),Number(r.toFixed(2)));var r}function ra(e,t,n){var r;return(r=n?e.v+qo*t:e.v-Yo*t)>1&&(r=1),Number(r.toFixed(2))}function oa(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],r=Fo(e),o=Xo;o>0;o-=1){var a=Zo(r),i=ea(Fo({h:ta(a,o,!0),s:na(a,o,!0),v:ra(a,o,!0)}));n.push(i)}n.push(ea(r));for(var s=1;s<=Jo;s+=1){var c=Zo(r),l=ea(Fo({h:ta(c,s),s:na(c,s),v:ra(c,s)}));n.push(l)}return"dark"===t.theme?Qo.map((function(e){var r,o,a,i=e.index,s=e.opacity;return ea((r=Fo(t.backgroundColor||"#141414"),a=100*s/100,{r:((o=Fo(n[i])).r-r.r)*a+r.r,g:(o.g-r.g)*a+r.g,b:(o.b-r.b)*a+r.b}))})):n}var aa={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},ia={},sa={};function ca(e){return':root,\n[data-override-theme="light"] {\n'.concat(e,"}")}function la(e){return'html[data-theme="dark-v2"],\n[data-override-theme="dark-v2"] {\n'.concat(e,"}")}function ua(e){return e.match(/[0-9a-fA-F]{2}/g).map((e=>parseInt(e,16))).join(", ")}function da(e,t,n){return"dark"===t?oa(e,{theme:t,backgroundColor:n})[5]:e}function fa(e){const t=[];if(["light","dark"].forEach((n=>{if(e[n])switch(e.type){case"brandColor":t.push(function(e,t){return("dark"===e?la:ca)("string"==typeof(n=t)?"  --color-brand: ".concat(n,";\n"):["  --color-brand: ".concat(n.default,";"),"  --color-brand-hover: ".concat(n.hover,";"),"  --color-brand-active: ".concat(n.active,";"),""].join("\n"));var n}(n,e[n]));break;case"baseColors":t.push(function(e,t,n){return("dark"===e?la:ca)("".concat(function(e,t){return Object.entries(e).flatMap((e=>{var[n,r]=e;return function(e){if(!/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(e))throw new Error("Invalid base color name: ".concat(JSON.stringify(e)))}(n),r.map(((e,r)=>["  --palette-".concat(n,"-").concat(r+1,"-channel: ").concat(ua(e),";")].concat("dark"===t?[]:"  --palette-".concat(n,"-").concat(r+1,": rgb(var(--palette-").concat(n,"-").concat(r+1,"-channel));")).join("\n"))).concat("")})).join("\n")}(function(e,t,n){return Object.fromEntries(Object.entries(e).map((e=>{var[r,o]=e;return[r,oa(o,"dark"===t?{theme:t,backgroundColor:n}:void 0)]})))}(t,e,n),e),"\n").concat(function(e,t,n){return Object.entries({green:"green",red:"red",blue:"blue",orange:"orange",cyan:"cyan",purple:"purple",geekblue:"indigo"}).flatMap((r=>{var[o,a]=r;return["  --theme-".concat(o,"-color-rgb-channel: ").concat(ua(da(t[a],e,n)),";"),..."dark"===e?[]:["  --theme-".concat(o,"-color: var(--palette-").concat(a,"-6);"),"  --theme-".concat(o,"-border-color: var(--palette-").concat(a,"-3);")],"  --theme-".concat(o,"-background: var(--palette-").concat(a,"-").concat("dark"===e?2:1,");"),""]})).join("\n")}(e,t,n)))}(n,e[n],e.backgroundColor));break;case"variables":t.push(function(e,t){return("dark"===e?la:ca)(function(e){return Object.entries(e).map((e=>{var[t,n]=e;return function(e){if(!/^--[a-z][a-z0-9]*(?:-[a-z0-9]+)*$/.test(e))throw new Error("Invalid css variable name: ".concat(JSON.stringify(e)))}(t),"  ".concat(t,": ").concat(n,";")})).concat("").join("\n")}(t))}(n,e[n]))}})),t.length>0){const e=document.createElement("style");return e.textContent=t.join("\n\n"),document.head.appendChild(e),()=>{e.remove()}}}let pa,ha,ma,ga,va;function ba(e){if(pa)throw new Error("Cannot create multiple runtimes");return window.addEventListener("message",(e=>{let{data:t}=e;if((null==t?void 0:t.source)!==U)return;const n=t.payload;switch(null==n?void 0:n.type){case F:K=n.active;break;case j:D=n.panel}})),va=null==e?void 0:e.hooks,(0,c.initializeI18n)(zt,Gt),d.locale(c.i18n.language),c.i18n.on("languageChanged",(()=>{d.locale(c.i18n.language)})),A(),pa=new Sa,pa}Object.keys(aa).forEach((function(e){ia[e]=oa(aa[e]),ia[e].primary=ia[e][5],sa[e]=oa(aa[e],{theme:"dark",backgroundColor:"#141414"}),sa[e].primary=sa[e][5]})),ia.red,ia.volcano,ia.gold,ia.orange,ia.yellow,ia.lime,ia.green,ia.cyan,ia.blue,ia.geekblue,ia.purple,ia.magenta,ia.grey;const ya=function(){const e=S();if(e)return function(){return new Proxy(e.getRuntime(),{get(){switch(arguments.length<=1?void 0:arguments[1]){case"getCurrentApp":case"getRecentApps":case"hasInstalledApp":case"getDesktops":case"getLaunchpadSettings":case"getLaunchpadSiteMap":case"toggleLaunchpadEffect":case"applyPageTitle":case"getNavConfig":case"getFeatureFlags":case"getMiscSettings":case"getBrandSettings":return Reflect.get(...arguments)}}})}}()||function(){return pa};var wa=new WeakMap,Ea=new WeakMap;class Sa{constructor(){(0,a.A)(this,wa,!1),(0,a.A)(this,Ea,!1),(0,o.A)(this,"version",3)}initialize(e){var t;if((0,s.A)(wa,this))throw new Error("The runtime cannot be initialized more than once");(0,i.A)(wa,this,!0),function(e){(0,u.isObject)(e.settings)&&(0,u.deepFreeze)(e.settings),e.brickPackages&&(0,u.deepFreeze)(e.brickPackages)}(e),ha=e;const{notification:n,dialog:r}=ka();var o;!1!==n&&(o=n??"basic.show-notification",(0,this.loadBricks)([o]).then((()=>{en=document.createElement(o)}),(e=>{console.error("Load notification service failed:",e)}))),!1!==r&&function(e,t){t([e]).then((()=>{qt=document.createElement(e)}),(e=>{console.error("Load dialog service failed:",e)}))}(r??"basic.show-dialog",this.loadBricks),function(e){e&&(e.brandColor?fa({type:"brandColor",...e.brandColor}):e.baseColors?fa({type:"baseColors",...e.baseColors}):e.variables&&fa({type:"variables",...e.variables}))}(null===(t=e.settings)||void 0===t||null===(t=t.misc)||void 0===t?void 0:t.theme)}async bootstrap(e){if(e&&this.initialize(e),(0,s.A)(Ea,this))throw new Error("The runtime cannot be bootstrapped more than once");(0,i.A)(Ea,this,!0),ma=new Io(ha.storyboards),await ma.bootstrap()}getRecentApps(){var e;return(null===(e=ma)||void 0===e?void 0:e.getRecentApps())??{}}getCurrentApp(){var e;return null===(e=ma)||void 0===e?void 0:e.getRecentApps().currentApp}hasInstalledApp(e,t){return Ge(e,t)}getFeatureFlags(){var e,t;return{...null===(e=ha)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.featureFlags,...null===(t=ma)||void 0===t||null===(t=t.getRecentApps().currentApp)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.featureFlags,"migrate-to-brick-next-v3":!0}}getMiscSettings(){var e,t;return{...null===(e=ha)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.misc,...null===(t=ma)||void 0===t||null===(t=t.getRecentApps().currentApp)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.settings)||void 0===t?void 0:t.misc}}getBrandSettings(){var e;return{base_title:"DevOps 管理专家",...null===(e=ha)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.brand}}getLaunchpadSettings(){var e;return{columns:7,rows:4,...null===(e=ha)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.launchpad}}getDesktops(){var e;return(null===(e=ha)||void 0===e?void 0:e.desktops)??[]}getLaunchpadSiteMap(){var e;return(null===(e=ha)||void 0===e?void 0:e.siteSort)??[]}toggleLaunchpadEffect(e){document.body.classList.toggle("launchpad-open",e)}applyPageTitle(e){var t;const n=this.getBrandSettings().base_title;document.title=(null===(t=ma)||void 0===t||null===(t=t.getRecentApps().currentApp)||void 0===t?void 0:t.localeTitle)||(e?`${e} - ${n}`:n)}getNavConfig(){var e;return null===(e=ma)||void 0===e?void 0:e.getNavConfig()}loadBricks(e){return(0,l.loadBricksImperatively)(e,Aa())}}function Aa(){var e;return ga??(ga=function(e,t){if(null==t||!t.length)return e;const n=new Map;return[...t,...e].forEach((e=>{const t=e.filePath.split("/")[1];n.has(t)||n.set(t,e)})),Array.from(n.values())}((null===(e=ha)||void 0===e?void 0:e.brickPackages)??Po??window.STANDALONE_BRICK_PACKAGES??[],window.PUBLIC_DEPS))}function ka(){var e;return(null===(e=ha)||void 0===e||null===(e=e.settings)||void 0===e?void 0:e.presetBricks)??{}}function Ia(){var e;return null===(e=ma)||void 0===e?void 0:e.getRenderId()}function Ca(){var e;return null===(e=ma)||void 0===e?void 0:e.getRuntimeContext()}function Ra(e){var t;return null===(t=ha)||void 0===t||null===(t=t.storyboards)||void 0===t?void 0:t.find((t=>t.app.id===e))}function Oa(e){var t;return null===(t=Ra(e))||void 0===t?void 0:t.app}function Ta(){for(var e,t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];null==va||null===(e=va.auth)||void 0===e||null===(t=e.authenticate)||void 0===t||t.call(e,...r)}function _a(){var e;return null==va||null===(e=va.auth)||void 0===e?void 0:e.getAuth()}function Pa(){var e,t;return null==va||null===(e=va.auth)||void 0===e||null===(t=e.logout)||void 0===t?void 0:t.call(e)}function xa(){var e;return null==va||null===(e=va.auth)||void 0===e?void 0:e.isLoggedIn()}var Ma=new WeakMap;const La=new class{constructor(){(0,a.A)(this,Ma,new Map)}define(e,t){(0,s.A)(Ma,this).has(e)?console.error(`Custom editor of "${e}" already registered`):(0,s.A)(Ma,this).set(e,t)}get(e){return(0,s.A)(Ma,this).get(e)}};async function $a(e,t,n){return nt(await Xe(e),e,"resolve",t,n)}function Ba(e){let t,{portal:n,scope:r="fragment",unknownBricks:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n;t=n||(()=>(a=document.createElement("div"),a.style.position="absolute",a.style.width=a.style.height="0",document.body.append(a),a));let i,s,l=!1;return{async render(n){let{theme:u,uiVersion:d,language:f,context:p,functions:m,templates:g,i18n:v,url:b,app:y}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(l)throw new Error("The root is unmounted and cannot be rendered any more");const w=[].concat(n),E=i,S=(0,h.uniqueId)("render-id-");i=new Hn(r,{unknownBricks:o,renderId:S});const A={ctxStore:new xr("CTX",void 0,i),pendingPermissionsPreCheck:[],tplStateStoreMap:new Map,formStateStoreMap:new Map};if(b){const e=new URL(b);A.query=e.searchParams,A.location={pathname:e.pathname,search:e.search,hash:e.hash,state:void 0}}const k={tag:_n.ROOT,container:e,createPortal:t};if("page"===r){var I;Q(u??"light"),ae("default"),uo(d),f&&await c.i18n.changeLanguage(f),y??(y={id:"demo",homepage:"/demo"}),A.app=y;const e={app:y,meta:{i18n:v,customTemplates:g}};null===(I=s)||void 0===I||I(),s=L(e),lo(e),me(m,y)}A.ctxStore.define(p,A);let C,R=!1,O=[];try{C=await Xr(k,w,A,i,[],{}),O=Qr(A),await Zr(C,A,O)}catch(e){R=!0,C={node:await qr(e,k,"page"===r),blockingList:[]}}if(k.child=C.node,null==E||E.dispatchOnUnmount(),null==E||E.dispose(),Pn(e),a&&Pn(a),"page"===r&&(R||i.dispatchBeforePageLoad(),te(),se()),xn(k),"page"===r&&window.scrollTo(0,0),!R){for(const e of O)e.mountAsyncData();"page"===r&&i.dispatchPageLoad(),i.dispatchOnMount(),i.initializeScrollIntoView(),i.initializeMediaChange(),i.initializeMessageDispatcher()}},unmount(){l||(l=!0,Pn(e),a&&(Pn(a),n||a.remove()))}}}function Na(e){let{useRealTimeQuery:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={...Ca()};t&&(n.query=new URLSearchParams(k().location.search));const r=t=>{if("string"==typeof t){if((0,O.isEvaluable)(t)){const e=ut(t,n);return Qe(e),e}return(0,_.inject)(t,n)}return!(0,u.isObject)(t)||Ze(e)?t:Array.isArray(t)?t.map((e=>r(e))):Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[r(t),r(n)]})))};return r(e)}}}]);
//# sourceMappingURL=5009.82f3a2ca.js.map